<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>《Android 开发艺术探索》- 第九章内容总结 - LoveDev</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="一个踏踏实实的程序员">





    <meta name="description" content="startActivity&amp;#x6587;&amp;#x7AE0;&amp;#x53C2;&amp;#x8003;&amp;#x4E86;gityuan&amp;#x535A;&amp;#x5BA2;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x300A;Android &amp;#x5F00;&amp;#x53D1;&amp;#x827A;&amp;#x672F;&amp;#x63A2;&amp;#x7D22;&amp;#x300B;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C; And">
<meta property="og:type" content="article">
<meta property="og:title" content="《Android 开发艺术探索》- 第九章内容总结">
<meta property="og:url" content="http://yoursite.com/2018/07/09/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AAndroid-%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B-%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%86%85%E5%AE%B9%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="LoveDev">
<meta property="og:description" content="startActivity&amp;#x6587;&amp;#x7AE0;&amp;#x53C2;&amp;#x8003;&amp;#x4E86;gityuan&amp;#x535A;&amp;#x5BA2;&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x300A;Android &amp;#x5F00;&amp;#x53D1;&amp;#x827A;&amp;#x672F;&amp;#x63A2;&amp;#x7D22;&amp;#x300B;&amp;#xFF0C;&amp;#x57FA;&amp;#x672C; And">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.kangxiaoguang.com/1531306968.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1531362885.png">
<meta property="article:published_time" content="2018-07-09T08:53:38.000Z">
<meta property="article:modified_time" content="2020-03-07T06:23:29.039Z">
<meta property="article:author" content="Kevin">
<meta property="article:tag" content="[object Object]">
<meta property="article:tag" content="读书笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.kangxiaoguang.com/1531306968.png">





<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159956718-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-159956718-1');
</script>


    


<meta name="generator" content="Hexo 4.2.1"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    <img src="/favicon.png" alt="" height="28">
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">archives</a>
            
            <a class="navbar-item "
               href="/tags">tags</a>
            
            <a class="navbar-item "
               href="/about">about</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜索" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/KevinLoveGitHub" target="_blank" rel="noopener">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article style="padding-top: 1.5rem!important;" class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            《Android 开发艺术探索》- 第九章内容总结
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2018-07-09T08:53:38.000Z" itemprop="datePublished">7月 9 2018</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            20 分钟 读完 (约 3039 字)
        </span>
        
    </div>

    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><h1 id="startActivity"><a href="#startActivity" class="headerlink" title="startActivity"></a>startActivity</h1><p><img src="https://image.kangxiaoguang.com/1531306968.png" alt><br>&#x6587;&#x7AE0;&#x53C2;&#x8003;&#x4E86;<a href="http://gityuan.com/2016/03/12/start-activity/" target="_blank" rel="noopener">gityuan&#x535A;&#x5BA2;</a>&#xFF0C;&#x4EE5;&#x53CA;&#x300A;Android &#x5F00;&#x53D1;&#x827A;&#x672F;&#x63A2;&#x7D22;&#x300B;&#xFF0C;&#x57FA;&#x672C; <strong>Android API 27</strong> &#x6E90;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x65E8;&#x5728;&#x7406;&#x89E3;&#x6574;&#x4E2A; Activity &#x542F;&#x52A8;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5FFD;&#x7565;&#x4EE3;&#x7801;&#x7EC6;&#x8282;</p>
<h2 id="1-1-Activity-startActivity"><a href="#1-1-Activity-startActivity" class="headerlink" title="1.1 Activity#startActivity"></a>1.1 Activity#startActivity</h2><p><code>startActivity</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A; <code>Activity</code>&#xFF0C;&#x4E14;&#x4E0D;&#x4F1A;&#x6536;&#x5230;&#x8BE5; <code>Activity</code> &#x9000;&#x51FA;&#x901A;&#x77E5;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A; <code>Intent#FLAG_ACTIVITY_NEW_TASK</code> &#x6807;&#x5FD7;&#xFF0C;&#x8BE5; <code>Activity</code> &#x4F1A;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x8C03;&#x7528;&#x8005;&#x7684;&#x6808;&#x4E2D;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(Intent intent, @Nullable Bundle options)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (options != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        startActivityForResult(intent, -<span class="hljs-number">1</span>, options);</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        startActivityForResult(intent, -<span class="hljs-number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x8BE5;&#x51FD;&#x6570;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528; <code>startActivityForResult</code>&#xFF0C;<code>startActivityForResult</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A; <code>Activity</code> &#x65F6;&#xFF0C;&#x8BE5; <code>Activity</code> &#x9000;&#x51FA;&#x65F6; <code>onActivityResult</code> &#x4F1A;&#x88AB;&#x56DE;&#x8C03;&#xFF0C;&#x4E14;&#x643A;&#x5E26;&#x4F20;&#x5165;&#x7684; <code>requestCode</code><p></p>
<h2 id="1-2-Activity-startActivityForResult"><a href="#1-2-Activity-startActivityForResult" class="headerlink" title="1.2 Activity#startActivityForResult"></a>1.2 Activity#startActivityForResult</h2><p>&#x4F7F;&#x7528; <code>startActivityForResult</code> &#x7684;&#x65F6;&#x5019; <code>Intent</code> &#x4E0D;&#x80FD;&#x8BBE;&#x7F6E; flag&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x8BBE;&#x7F6E; <code>Intent#FLAG_ACTIVITY_NEW_TASK</code> &#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x7ACB;&#x9A6C;&#x6536;&#x5230;&#x4E00;&#x4E2A; <code>cancel</code> &#x7684;&#x901A;&#x77E5;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x60C5;&#x51B5;&#xFF1A;&#x5982;&#x679C;&#x5728; <code>Activity</code> &#x7684; <code>onCreate/onResume</code> &#x4E2D;&#x4F7F;&#x7528; <code>startActivityForResult</code>&#xFF0C;&#x5FC5;&#x987B;&#x7B49;&#x5230;&#x6709;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x8BE5; <code>Activity</code> &#x624D;&#x4F1A;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x91CD;&#x5B9A;&#x5411;&#x65F6;&#x9020;&#x6210;&#x95EA;&#x5C4F;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startActivityForResult</span><span class="hljs-params">(@RequiresPermission Intent intent, <span class="hljs-keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        @Nullable Bundle options)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (mParent == <span class="hljs-keyword">null</span>) {</span><br><span class="line">        options = transferSpringboardActivityOptions(options);</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        Instrumentation.ActivityResult ar =</span><br><span class="line">            mInstrumentation.execStartActivity(</span><br><span class="line">                <span class="hljs-keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="hljs-keyword">this</span>,</span><br><span class="line">                intent, requestCode, options);</span><br><span class="line">        <span class="hljs-keyword">if</span> (ar != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            mMainThread.sendActivityResult(</span><br><span class="line">                mToken, mEmbeddedID, requestCode, ar.getResultCode(),</span><br><span class="line">                ar.getResultData());</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (requestCode &gt;= <span class="hljs-number">0</span>) {</span><br><span class="line">            mStartedActivity = <span class="hljs-keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        cancelInputsAndStartExitTransition(options);</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br><code>mParent == null</code> &#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#x662F;&#x6210;&#x7ACB;&#x7684;&#xFF0C;<code>mParent</code> &#x5728; <code>Activity#attach</code> &#x4E2D;&#x88AB;&#x8D4B;&#x503C;&#xFF0C;&#x5728;&#x540E;&#x9762;&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E2D;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x5B9E; <code>attach</code> &#x4E2D; <code>parent</code> &#x53C2;&#x6570;&#x5C31;&#x662F; <code>null</code><p></p>
<h2 id="1-3-Instrumentation-execStartActivity"><a href="#1-3-Instrumentation-execStartActivity" class="headerlink" title="1.3 Instrumentation#execStartActivity"></a>1.3 Instrumentation#execStartActivity</h2><p>&#x63A5;&#x4E0B;&#x6765;&#x770B; <code>Instrumentation#execStartActivity</code>&#xFF0C;&#x53EF;&#x80FD;&#x7531;&#x4E8E;&#x7248;&#x672C;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5728;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x5BF9;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x4F46;&#x662F;&#x6E90;&#x7801;&#x4E2D;&#x786E;&#x5B9E;&#x662F;&#x6709;&#x7684;&#xFF0C;&#x63D0;&#x53D6;&#x6709;&#x7528;&#x7684;&#x4FE1;&#x606F;&#x5927;&#x610F;&#x5982;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>&#x6267;&#x884C;&#x4E00;&#x4E2A; startActivity &#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;&#x8D1F;&#x8D23;&#x66F4;&#x65B0;&#x6D3B;&#x52A8;&#x5BF9;&#x8C61;&#x5E76;&#x6B64;&#x8C03;&#x7528;&#x5206;&#x6D3E;&#x7ED9; system activity manager</p>
</blockquote>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> ActivityResult <span class="hljs-title">execStartActivity</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        Context who, IBinder contextThread, IBinder token, Activity target,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        Intent intent, <span class="hljs-keyword">int</span> requestCode, Bundle options)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-keyword">try</span> {</span><br><span class="line">        intent.migrateExtraStreamToClipData();</span><br><span class="line">        intent.prepareToLeaveProcess(who);</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        <span class="hljs-keyword">int</span> result = ActivityManager.getService()</span><br><span class="line">            .startActivity(whoThread, who.getBasePackageName(), intent,</span><br><span class="line">                    intent.resolveTypeIfNeeded(who.getContentResolver()),</span><br><span class="line">                    token, target != <span class="hljs-keyword">null</span> ? target.mEmbeddedID : <span class="hljs-keyword">null</span>,</span><br><span class="line">                    requestCode, <span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>, options);</span><br><span class="line">        checkStartActivityResult(result, intent);</span><br><span class="line">    } <span class="hljs-keyword">catch</span> (RemoteException e) {</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Failure from system&quot;</span>, e);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br><code>ActivityManager.getService().startActivity</code> &#x4E5F;&#x5C31;&#x8BC1;&#x660E;&#x4E86;&#x4E0A;&#x9762;&#x5BF9;&#x8BE5;&#x51FD;&#x6570;&#x89E3;&#x91CA;&#xFF0C;&#x5176;&#x5B9E; <code>ActivityManager.getService()</code> &#x83B7;&#x5F97;&#x7684;&#x5C31;&#x662F; <code>IActivityManager</code> &#x7C7B;&#x578B;&#x7684; <code>IBinder</code> &#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A; Binder &#x5BF9;&#x8C61;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5C31;&#x662F; <code>ActivityManager(AMS)</code>&#xFF0C;&#x5229;&#x7528;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x5B9E;&#x4F8B;&#xFF1A;<p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActivityManager <span class="hljs-title">getService</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> IActivityManagerSingleton.get();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Singleton&lt;IActivityManager&gt; IActivityManagerSingleton =</span><br><span class="line">        <span class="hljs-keyword">new</span> Singleton&lt;IActivityManager&gt;() {</span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-function"><span class="hljs-keyword">protected</span> IActivityManager <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">                <span class="hljs-keyword">final</span> IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);</span><br><span class="line">                <span class="hljs-keyword">final</span> IActivityManager am = IActivityManager.Stub.asInterface(b);</span><br><span class="line">                <span class="hljs-keyword">return</span> am;</span><br><span class="line">            }</span><br><span class="line">        };</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="1-4-ActivityManagerService-startActivity"><a href="#1-4-ActivityManagerService-startActivity" class="headerlink" title="1.4 ActivityManagerService#startActivity"></a>1.4 ActivityManagerService#startActivity</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions)</span> </span>{</span><br><span class="line">    <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">    <span class="hljs-keyword">return</span> startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,</span><br><span class="line">            resultWho, requestCode, startFlags, profilerInfo, bOptions,</span><br><span class="line">            UserHandle.getCallingUserId());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="1-5-ActivityManagerService-startActivityAsUser"><a href="#1-5-ActivityManagerService-startActivityAsUser" class="headerlink" title="1.5 ActivityManagerService#startActivityAsUser"></a>1.5 ActivityManagerService#startActivityAsUser</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityAsUser</span><span class="hljs-params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions, <span class="hljs-keyword">int</span> userId)</span> </span>{</span><br><span class="line">    enforceNotIsolatedCaller(<span class="hljs-string">&quot;startActivity&quot;</span>);</span><br><span class="line">    userId = mUserController.handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(),</span><br><span class="line">            userId, <span class="hljs-keyword">false</span>, ALLOW_FULL_ONLY, <span class="hljs-string">&quot;startActivity&quot;</span>, <span class="hljs-keyword">null</span>);</span><br><span class="line">    <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">    <span class="hljs-keyword">return</span> mActivityStarter.startActivityMayWait(caller, -<span class="hljs-number">1</span>, callingPackage, intent,</span><br><span class="line">            resolvedType, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, resultTo, resultWho, requestCode, startFlags,</span><br><span class="line">            profilerInfo, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, bOptions, <span class="hljs-keyword">false</span>, userId, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;startActivityAsUser&quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x5728;&#x8BE5;&#x51FD;&#x6570;&#x4E2D;&#x53C8;&#x5C06;&#x8C03;&#x7528;&#x8F6C;&#x5165;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;&#x4E2D; <code>ActivityStarter</code><p></p>
<h2 id="1-6-ActivityStarter-startActivityMayWait"><a href="#1-6-ActivityStarter-startActivityMayWait" class="headerlink" title="1.6 ActivityStarter#startActivityMayWait"></a>1.6 ActivityStarter#startActivityMayWait</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityMayWait</span><span class="hljs-params">(IApplicationThread caller, <span class="hljs-keyword">int</span> callingUid,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        String callingPackage, Intent intent, String resolvedType,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ProfilerInfo profilerInfo, WaitResult outResult,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        Configuration globalConfig, Bundle bOptions, <span class="hljs-keyword">boolean</span> ignoreTargetSecurity, <span class="hljs-keyword">int</span> userId,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        TaskRecord inTask, String reason)</span> </span>{</span><br><span class="line">        <span class="hljs-comment">// &#x4FDD;&#x62A4;&#x6027;&#x62F7;&#x8D1D;&#xFF0C;&#x4E0D;&#x4F1A;&#x4FEE;&#x6539;&#x5BA2;&#x6237;&#x7AEF;&#x7684; Intent &#x5BF9;&#x8C61;</span></span><br><span class="line">        intent = <span class="hljs-keyword">new</span> Intent(intent);</span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">// &#x89E3;&#x6790; Intent &#x4E2D;&#x7684;&#x5185;&#x5BB9;</span></span><br><span class="line">        ActivityInfo aInfo = mSupervisor.resolveActivity(intent, rInfo, startFlags, profilerInfo);</span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-keyword">final</span> ActivityRecord[] outRecord = <span class="hljs-keyword">new</span> ActivityRecord[<span class="hljs-number">1</span>];</span><br><span class="line">        <span class="hljs-comment">// &#x7EE7;&#x7EED;&#x8C03;&#x7528; startActivityLocked &#x83B7;&#x53D6;&#x8FD4;&#x56DE;&#x503C;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">        <span class="hljs-keyword">int</span> res = startActivityLocked(caller, intent, ephemeralIntent, resolvedType,</span><br><span class="line">                aInfo, rInfo, voiceSession, voiceInteractor,</span><br><span class="line">                resultTo, resultWho, requestCode, callingPid,</span><br><span class="line">                callingUid, callingPackage, realCallingPid, realCallingUid, startFlags,</span><br><span class="line">                options, ignoreTargetSecurity, componentSpecified, outRecord, inTask,</span><br><span class="line">                reason);</span><br><span class="line">    </span><br><span class="line">        Binder.restoreCallingIdentity(origId);</span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x901A;&#x8FC7; <code>ActivityStackSupervisor#resolveActivity</code> &#x83B7;&#x53D6; Activity &#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4F20;&#x9012;&#x7ED9; <code>startActivityLocked</code><p></p>
<h2 id="1-7-ActivityStarter-startActivityLocked"><a href="#1-7-ActivityStarter-startActivityLocked" class="headerlink" title="1.7 ActivityStarter#startActivityLocked"></a>1.7 ActivityStarter#startActivityLocked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">startActivityLocked</span><span class="hljs-params">(IApplicationThread caller, Intent intent, Intent ephemeralIntent,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        String resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">int</span> callingPid, <span class="hljs-keyword">int</span> callingUid,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        String callingPackage, <span class="hljs-keyword">int</span> realCallingPid, <span class="hljs-keyword">int</span> realCallingUid, <span class="hljs-keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityOptions options, <span class="hljs-keyword">boolean</span> ignoreTargetSecurity, <span class="hljs-keyword">boolean</span> componentSpecified,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityRecord[] outActivity, TaskRecord inTask, String reason)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-comment">// &#x7EE7;&#x7EED;&#x8C03;&#x7528; startActivity &#x83B7;&#x53D6;&#x8FD4;&#x56DE;&#x503C;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class="line">    mLastStartActivityResult = startActivity(caller, intent, ephemeralIntent, resolvedType,</span><br><span class="line">            aInfo, rInfo, voiceSession, voiceInteractor, resultTo, resultWho, requestCode,</span><br><span class="line">            callingPid, callingUid, callingPackage, realCallingPid, realCallingUid, startFlags,</span><br><span class="line">            options, ignoreTargetSecurity, componentSpecified, mLastStartActivityRecord,</span><br><span class="line">            inTask);</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-comment">// Aborted results are treated as successes externally, but we must track them internally.</span></span><br><span class="line">    <span class="hljs-keyword">return</span> mLastStartActivityResult != START_ABORTED ? mLastStartActivityResult : START_SUCCESS;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="1-8-ActivityStarter-startActivity"><a href="#1-8-ActivityStarter-startActivity" class="headerlink" title="1.8 ActivityStarter#startActivity"></a>1.8 ActivityStarter#startActivity</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/** DO NOT call this method directly. Use {<span class="hljs-doctag">@link</span> #startActivityLocked} instead. */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(IApplicationThread caller, Intent intent, Intent ephemeralIntent,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        String resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">int</span> callingPid, <span class="hljs-keyword">int</span> callingUid,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        String callingPackage, <span class="hljs-keyword">int</span> realCallingPid, <span class="hljs-keyword">int</span> realCallingUid, <span class="hljs-keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityOptions options, <span class="hljs-keyword">boolean</span> ignoreTargetSecurity, <span class="hljs-keyword">boolean</span> componentSpecified,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityRecord[] outActivity, TaskRecord inTask)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-comment">// &#x53EA;&#x7528;&#x5173;&#x5FC3;&#x6700;&#x540E;&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x7EE7;&#x7EED;&#x8C03;&#x7528; startActivity &#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="hljs-keyword">return</span> startActivity(r, sourceRecord, voiceSession, voiceInteractor, startFlags, <span class="hljs-keyword">true</span>,</span><br><span class="line">            options, inTask, outActivity);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> startFlags, <span class="hljs-keyword">boolean</span> doResume, ActivityOptions options, TaskRecord inTask,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityRecord[] outActivity)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">int</span> result = START_CANCELED;</span><br><span class="line">    <span class="hljs-keyword">try</span> {</span><br><span class="line">        mService.mWindowManager.deferSurfaceLayout();</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        result = startActivityUnchecked(r, sourceRecord, voiceSession, voiceInteractor,</span><br><span class="line">                startFlags, doResume, options, inTask, outActivity);</span><br><span class="line">    } <span class="hljs-keyword">finally</span> {</span><br><span class="line">        <span class="hljs-keyword">if</span> (!ActivityManager.isStartResultSuccessful(result)</span><br><span class="line">                &amp;&amp; mStartActivity.getTask() != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            mStartActivity.getTask().removeActivity(mStartActivity);</span><br><span class="line">        }</span><br><span class="line">        mService.mWindowManager.continueSurfaceLayout();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    postStartActivityProcessing(r, result, mSupervisor.getLastStack().mStackId,  mSourceRecord,</span><br><span class="line">            mTargetStack);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="1-9-ActivityStarter-startActivityUnchecked"><a href="#1-9-ActivityStarter-startActivityUnchecked" class="headerlink" title="1.9 ActivityStarter#startActivityUnchecked"></a>1.9 ActivityStarter#startActivityUnchecked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityUnchecked</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> startFlags, <span class="hljs-keyword">boolean</span> doResume, ActivityOptions options, TaskRecord inTask,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityRecord[] outActivity)</span> </span>{</span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        mTargetStack.startActivityLocked(mStartActivity, topFocused, newTask, mKeepCurTransition,</span><br><span class="line">            mOptions);</span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">return</span> START_SUCCESS;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br><code>ActivityStarter</code> &#x4E3B;&#x8981;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x6536;&#x96C6; <code>Intent</code> &#x548C; <code>flag</code>&#xFF0C;&#x5E76;&#x4E14;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A; <code>ActivityStack</code> &#x5BF9;&#x8C61;&#xFF0C;&#x8C03;&#x7528; <code>ActivityStack#startActivityLocked</code><p></p>
<h2 id="2-0-ActivityStack-startActivityLocked"><a href="#2-0-ActivityStack-startActivityLocked" class="headerlink" title="2.0 ActivityStack#startActivityLocked"></a>2.0 ActivityStack#startActivityLocked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startActivityLocked</span><span class="hljs-params">(ActivityRecord r, ActivityRecord focusedTopActivity,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> newTask, <span class="hljs-keyword">boolean</span> keepCurTransition, ActivityOptions options)</span> </span>{</span><br><span class="line">    TaskRecord rTask = r.getTask();</span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> taskId = rTask.taskId;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!r.mLaunchTaskBehind &amp;&amp; (taskForIdLocked(taskId) == <span class="hljs-keyword">null</span> || newTask)) {</span><br><span class="line">        <span class="hljs-comment">// &#x628A;&#x5F53;&#x524D; Activity &#x653E;&#x5230;&#x6808;&#x9876;</span></span><br><span class="line">        insertTaskAtTop(rTask, r);</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x4ECE;&#x8BE5;&#x51FD;&#x6570;&#x6E90;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x731C;&#x6D4B;&#x51FA;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x4E00;&#x65B9;&#x9762;&#x5728;&#x64CD;&#x4F5C; Activity &#x7684;&#x5806;&#x6808;&#xFF0C;Activity &#x7684;&#x52A8;&#x753B;&#x4EE5;&#x53CA;&#x548C; WindowManagerService &#x7684;&#x4EA4;&#x4E92;&#xFF0C;&#x4E4B;&#x540E;&#x8FD8;&#x8981;&#x56DE;&#x5230; <code>ActivityStarter#startActivityUnchecked</code><p></p>
<h2 id="2-1-ActivityStarter-startActivityUnchecked"><a href="#2-1-ActivityStarter-startActivityUnchecked" class="headerlink" title="2.1 ActivityStarter#startActivityUnchecked"></a>2.1 ActivityStarter#startActivityUnchecked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityUnchecked</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> startFlags, <span class="hljs-keyword">boolean</span> doResume, ActivityOptions options, TaskRecord inTask,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityRecord[] outActivity)</span> </span>{</span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-keyword">if</span> (mDoResume) {</span><br><span class="line">            <span class="hljs-keyword">final</span> ActivityRecord topTaskActivity =</span><br><span class="line">                    mStartActivity.getTask().topRunningActivityLocked();</span><br><span class="line">            <span class="hljs-keyword">if</span> (!mTargetStack.isFocusable()</span><br><span class="line">                    || (topTaskActivity != <span class="hljs-keyword">null</span> &amp;&amp; topTaskActivity.mTaskOverlay</span><br><span class="line">                    &amp;&amp; mStartActivity != topTaskActivity)) {</span><br><span class="line">                mTargetStack.ensureActivitiesVisibleLocked(<span class="hljs-keyword">null</span>, <span class="hljs-number">0</span>, !PRESERVE_WINDOWS);</span><br><span class="line">                mWindowManager.executeAppTransition();</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                <span class="hljs-keyword">if</span> (mTargetStack.isFocusable() &amp;&amp; !mSupervisor.isFocusedStack(mTargetStack)) {</span><br><span class="line">                    mTargetStack.moveToFront(<span class="hljs-string">&quot;startActivityUnchecked&quot;</span>);</span><br><span class="line">                }</span><br><span class="line">                <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">                mSupervisor.resumeFocusedStackTopActivityLocked(mTargetStack, mStartActivity,</span><br><span class="line">                        mOptions);</span><br><span class="line">            }</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            mTargetStack.addRecentActivityLocked(mStartActivity);</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">    <span class="hljs-keyword">return</span> START_SUCCESS;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="2-2-ASS-resumeFocusedStackTopActivityLocked"><a href="#2-2-ASS-resumeFocusedStackTopActivityLocked" class="headerlink" title="2.2 ASS#resumeFocusedStackTopActivityLocked"></a>2.2 ASS#resumeFocusedStackTopActivityLocked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">resumeFocusedStackTopActivityLocked</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityStack targetStack, ActivityRecord target, ActivityOptions targetOptions)</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (!readyToResume()) {</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (targetStack != <span class="hljs-keyword">null</span> &amp;&amp; isFocusedStack(targetStack)) {</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        <span class="hljs-keyword">return</span> targetStack.resumeTopActivityUncheckedLocked(target, targetOptions);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">final</span> ActivityRecord r = mFocusedStack.topRunningActivityLocked();</span><br><span class="line">    <span class="hljs-keyword">if</span> (r == <span class="hljs-keyword">null</span> || r.state != RESUMED) {</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        mFocusedStack.resumeTopActivityUncheckedLocked(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);</span><br><span class="line">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r.state == RESUMED) {</span><br><span class="line">        mFocusedStack.executeAppTransition(targetOptions);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="2-3-ASS-resumeTopActivityUncheckedLocked"><a href="#2-3-ASS-resumeTopActivityUncheckedLocked" class="headerlink" title="2.3 ASS#resumeTopActivityUncheckedLocked"></a>2.3 ASS#resumeTopActivityUncheckedLocked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">resumeTopActivityUncheckedLocked</span><span class="hljs-params">(ActivityRecord prev, ActivityOptions options)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (mStackSupervisor.inResumeTopActivity) {</span><br><span class="line">        <span class="hljs-comment">// Don&apos;t even start recursing.</span></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;</span><br><span class="line">    <span class="hljs-keyword">try</span> {</span><br><span class="line">        <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">        mStackSupervisor.inResumeTopActivity = <span class="hljs-keyword">true</span>;</span><br><span class="line">        result = resumeTopActivityInnerLocked(prev, options);</span><br><span class="line">    } <span class="hljs-keyword">finally</span> {</span><br><span class="line">        mStackSupervisor.inResumeTopActivity = <span class="hljs-keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">final</span> ActivityRecord next = topRunningActivityLocked(<span class="hljs-keyword">true</span> <span class="hljs-comment">/* focusableOnly */</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (next == <span class="hljs-keyword">null</span> || !next.canTurnScreenOn()) {</span><br><span class="line">        checkReadyForSleep();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="2-4-ASS-resumeTopActivityInnerLocked"><a href="#2-4-ASS-resumeTopActivityInnerLocked" class="headerlink" title="2.4 ASS#resumeTopActivityInnerLocked"></a>2.4 ASS#resumeTopActivityInnerLocked</h2><p>&#x8BE5;&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;&#x4E86; <code>ActivityStackSupervisor#startSpecificActivityLocked</code></p>
<h2 id="2-5-ASS-startSpecificActivityLocked"><a href="#2-5-ASS-startSpecificActivityLocked" class="headerlink" title="2.5 ASS#startSpecificActivityLocked"></a>2.5 ASS#startSpecificActivityLocked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">startSpecificActivityLocked</span><span class="hljs-params">(ActivityRecord r,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> andResume, <span class="hljs-keyword">boolean</span> checkConfig)</span> </span>{</span><br><span class="line">    <span class="hljs-comment">// Is this activity&apos;s application already running?</span></span><br><span class="line">    ProcessRecord app = mService.getProcessRecordLocked(r.processName,</span><br><span class="line">            r.info.applicationInfo.uid, <span class="hljs-keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    r.getStack().setLaunchTime(r);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (app != <span class="hljs-keyword">null</span> &amp;&amp; app.thread != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        <span class="hljs-keyword">try</span> {</span><br><span class="line">            <span class="hljs-keyword">if</span> ((r.info.flags&amp;ActivityInfo.FLAG_MULTIPROCESS) == <span class="hljs-number">0</span></span><br><span class="line">                    || !<span class="hljs-string">&quot;android&quot;</span>.equals(r.info.packageName)) {</span><br><span class="line">                    app.addPackage(r.info.packageName, r.info.applicationInfo.versionCode,</span><br><span class="line">                        mService.mProcessStats);</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">            realStartActivityLocked(r, app, andResume, checkConfig);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        } <span class="hljs-keyword">catch</span> (RemoteException e) {</span><br><span class="line">            Slog.w(TAG, <span class="hljs-string">&quot;Exception when starting activity &quot;</span></span><br><span class="line">                    + r.intent.getComponent().flattenToShortString(), e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    mService.startProcessLocked(r.processName, r.info.applicationInfo, <span class="hljs-keyword">true</span>, <span class="hljs-number">0</span>,</span><br><span class="line">            <span class="hljs-string">&quot;activity&quot;</span>, r.intent.getComponent(), <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="2-6-ASS-realStartActivityLocked"><a href="#2-6-ASS-realStartActivityLocked" class="headerlink" title="2.6 ASS#realStartActivityLocked"></a>2.6 ASS#realStartActivityLocked</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">realStartActivityLocked</span><span class="hljs-params">(ActivityRecord r, ProcessRecord app,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> andResume, <span class="hljs-keyword">boolean</span> checkConfig)</span> <span class="hljs-keyword">throws</span> RemoteException </span>{</span><br><span class="line">        ...</span><br><span class="line">        app.thread.scheduleLaunchActivity(<span class="hljs-keyword">new</span> Intent(r.intent), r.appToken,</span><br><span class="line">                    System.identityHashCode(r), r.info,</span><br><span class="line">                    mergedConfiguration.getGlobalConfiguration(),</span><br><span class="line">                    mergedConfiguration.getOverrideConfiguration(), r.compat,</span><br><span class="line">                    r.launchedFromPackage, task.voiceInteractor, app.repProcState, r.icicle,</span><br><span class="line">                    r.persistentState, results, newIntents, !andResume,</span><br><span class="line">                    mService.isNextTransitionForward(), profilerInfo);</span><br><span class="line">        ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x5176;&#x4E2D; <code>app.thread</code> &#x5C31;&#x662F; <code>IApplicationThread</code>&#xFF0C;&#x800C; <code>IApplicationThread</code> &#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x662F; <code>ActivityThrea</code> &#x7684;&#x5185;&#x90E8;&#x7C7B; <code>ApplicationThread</code><p></p>
<h2 id="2-7-AT-scheduleLaunchActivity"><a href="#2-7-AT-scheduleLaunchActivity" class="headerlink" title="2.7 AT#scheduleLaunchActivity"></a>2.7 AT#scheduleLaunchActivity</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">scheduleLaunchActivity</span><span class="hljs-params">(Intent intent, IBinder token, <span class="hljs-keyword">int</span> ident,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        ActivityInfo info, Configuration curConfig, Configuration overrideConfig,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> procState, Bundle state, PersistableBundle persistentState,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> notResumed, <span class="hljs-keyword">boolean</span> isForward, ProfilerInfo profilerInfo)</span> </span>{</span><br><span class="line"></span><br><span class="line">    updateProcessState(procState, <span class="hljs-keyword">false</span>);</span><br><span class="line">    <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">    ActivityClientRecord r = <span class="hljs-keyword">new</span> ActivityClientRecord();</span><br><span class="line">    r.token = token;</span><br><span class="line">    r.ident = ident;</span><br><span class="line">    r.intent = intent;</span><br><span class="line">    r.referrer = referrer;</span><br><span class="line">    r.voiceInteractor = voiceInteractor;</span><br><span class="line">    r.activityInfo = info;</span><br><span class="line">    r.compatInfo = compatInfo;</span><br><span class="line">    r.state = state;</span><br><span class="line">    r.persistentState = persistentState;</span><br><span class="line"></span><br><span class="line">    r.pendingResults = pendingResults;</span><br><span class="line">    r.pendingIntents = pendingNewIntents;</span><br><span class="line"></span><br><span class="line">    r.startsNotResumed = notResumed;</span><br><span class="line">    r.isForward = isForward;</span><br><span class="line"></span><br><span class="line">    r.profilerInfo = profilerInfo;</span><br><span class="line"></span><br><span class="line">    r.overrideConfig = overrideConfig;</span><br><span class="line">    updatePendingConfiguration(curConfig);</span><br><span class="line"></span><br><span class="line">    sendMessage(H.LAUNCH_ACTIVITY, r);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x4E00;&#x4E2A; <code>ActivityClientRecord</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x4E2D; <code>parent</code> &#x5E76;&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x8FD9;&#x4E2A; <code>parent</code> &#x5B57;&#x6BB5;&#x6B63;&#x662F; <code>Activity</code> &#x4E2D;&#x7684;&#x4E3A; <code>mParent</code> &#x8D4B;&#x503C;&#x7684;&#x90A3;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x6B64;&#x65F6;&#x628A;&#x8FD9;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#x4EA4;&#x7ED9;  Handler &#x5904;&#x7406;&#xFF1A;<p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">case</span> LAUNCH_ACTIVITY: {</span><br><span class="line">    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;activityStart&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;</span><br><span class="line"></span><br><span class="line">    r.packageInfo = getPackageInfoNoCheck(</span><br><span class="line">            r.activityInfo.applicationInfo, r.compatInfo);</span><br><span class="line">    <span class="hljs-comment">// &#x91CD;&#x70B9;&#x4EE3;&#x7801;</span></span><br><span class="line">    handleLaunchActivity(r, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;LAUNCH_ACTIVITY&quot;</span>);</span><br><span class="line">    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">} <span class="hljs-keyword">break</span>;</span><br></pre></td></tr></tbody></table></figure><br>&#x7EE7;&#x7EED;&#x8C03;&#x7528; <code>handleLaunchActivity</code><p></p>
<h2 id="2-8-AT-handleLaunchActivity"><a href="#2-8-AT-handleLaunchActivity" class="headerlink" title="2.8 AT#handleLaunchActivity"></a>2.8 AT#handleLaunchActivity</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleLaunchActivity</span><span class="hljs-params">(ActivityClientRecord r, Intent customIntent, String reason)</span> </span>{</span><br><span class="line">    <span class="hljs-comment">// If we are getting ready to gc after going to the background, well</span></span><br><span class="line">    <span class="hljs-comment">// we are back active so skip it.</span></span><br><span class="line">    unscheduleGcIdler();</span><br><span class="line">    mSomeActivitiesChanged = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (r.profilerInfo != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        mProfiler.setProfiler(r.profilerInfo);</span><br><span class="line">        mProfiler.startProfiling();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Make sure we are running with the most recent config.</span></span><br><span class="line">    handleConfigurationChanged(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (localLOGV) Slog.v(</span><br><span class="line">        TAG, <span class="hljs-string">&quot;Handling launch of &quot;</span> + r);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Initialize before creating the activity</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (!ThreadedRenderer.sRendererDisabled) {</span><br><span class="line">        GraphicsEnvironment.earlyInitEGL();</span><br><span class="line">    }</span><br><span class="line">    WindowManagerGlobal.initialize();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// &#x5230;&#x8FD9;&#x91CC; Activity &#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#x51FA;&#x6765;</span></span><br><span class="line">    Activity a = performLaunchActivity(r, customIntent);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (a != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        r.createdConfig = <span class="hljs-keyword">new</span> Configuration(mConfiguration);</span><br><span class="line">        reportSizeConfigurations(r);</span><br><span class="line">        Bundle oldState = r.state;</span><br><span class="line">        handleResumeActivity(r.token, <span class="hljs-keyword">false</span>, r.isForward,</span><br><span class="line">                !r.activity.mFinished &amp;&amp; !r.startsNotResumed, r.lastProcessedSeq, reason);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (!r.activity.mFinished &amp;&amp; r.startsNotResumed) {</span><br><span class="line">            </span><br><span class="line">            performPauseActivityIfNeeded(r, reason);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (r.isPreHoneycomb()) {</span><br><span class="line">                r.state = oldState;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-comment">// If there was an error, for any reason, tell the activity manager to stop us.</span></span><br><span class="line">        <span class="hljs-keyword">try</span> {</span><br><span class="line">            ActivityManager.getService()</span><br><span class="line">                .finishActivity(r.token, Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>,</span><br><span class="line">                        Activity.DONT_FINISH_TASK_WITH_ACTIVITY);</span><br><span class="line">        } <span class="hljs-keyword">catch</span> (RemoteException ex) {</span><br><span class="line">            <span class="hljs-keyword">throw</span> ex.rethrowFromSystemServer();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="2-9-AT-performLaunchActivity"><a href="#2-9-AT-performLaunchActivity" class="headerlink" title="2.9 AT#performLaunchActivity"></a>2.9 AT#performLaunchActivity</h2><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> Activity <span class="hljs-title">performLaunchActivity</span><span class="hljs-params">(ActivityClientRecord r, Intent customIntent)</span> </span>{</span><br><span class="line">    <span class="hljs-comment">// System.out.println(&quot;##### [&quot; + System.currentTimeMillis() + &quot;] ActivityThread.performLaunchActivity(&quot; + r + &quot;)&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// &#x83B7;&#x53D6; Activity &#x7684;&#x7EC4;&#x4EF6;&#x4FE1;&#x606F;</span></span><br><span class="line">    ActivityInfo aInfo = r.activityInfo;</span><br><span class="line">    <span class="hljs-keyword">if</span> (r.packageInfo == <span class="hljs-keyword">null</span>) {</span><br><span class="line">        r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,</span><br><span class="line">                Context.CONTEXT_INCLUDE_CODE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ComponentName component = r.intent.getComponent();</span><br><span class="line">    <span class="hljs-keyword">if</span> (component == <span class="hljs-keyword">null</span>) {</span><br><span class="line">        component = r.intent.resolveActivity(</span><br><span class="line">            mInitialApplication.getPackageManager());</span><br><span class="line">        r.intent.setComponent(component);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (r.activityInfo.targetActivity != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        component = <span class="hljs-keyword">new</span> ComponentName(r.activityInfo.packageName,</span><br><span class="line">                r.activityInfo.targetActivity);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// &#x521B;&#x5EFA; ContextImpl &#x5BF9;&#x8C61;</span></span><br><span class="line">    ContextImpl appContext = createBaseContextForActivity(r);</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">// &#x901A;&#x8FC7; Instrumentation#newActivity &#x521B;&#x5EFA; Activity &#x5BF9;&#x8C61;</span></span><br><span class="line">    Activity activity = <span class="hljs-keyword">null</span>;</span><br><span class="line">    <span class="hljs-keyword">try</span> {</span><br><span class="line">        java.lang.ClassLoader cl = appContext.getClassLoader();</span><br><span class="line">        activity = mInstrumentation.newActivity(</span><br><span class="line">                cl, component.getClassName(), r.intent);</span><br><span class="line">        StrictMode.incrementExpectedActivityCount(activity.getClass());</span><br><span class="line">        r.intent.setExtrasClassLoader(cl);</span><br><span class="line">        r.intent.prepareToEnterProcess();</span><br><span class="line">        <span class="hljs-keyword">if</span> (r.state != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            r.state.setClassLoader(cl);</span><br><span class="line">        }</span><br><span class="line">    } <span class="hljs-keyword">catch</span> (Exception e) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (!mInstrumentation.onException(activity, e)) {</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="hljs-string">&quot;Unable to instantiate activity &quot;</span> + component</span><br><span class="line">                + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// &#x901A;&#x8FC7; LoadedApk#makeApplication &#x521B;&#x5EFA; Application &#x5BF9;&#x8C61;</span></span><br><span class="line">    <span class="hljs-comment">// &#x5176;&#x4E2D; makeApplication &#x7684;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x5982;&#x679C; Application != null &#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span></span><br><span class="line">    <span class="hljs-comment">// &#x8BC1;&#x660E;&#x4E86; Application &#x5BF9;&#x8C61;&#x53EA;&#x6709;&#x4E00;&#x4E2A;</span></span><br><span class="line">    <span class="hljs-keyword">try</span> {</span><br><span class="line">        Application app = r.packageInfo.makeApplication(<span class="hljs-keyword">false</span>, mInstrumentation);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (localLOGV) Slog.v(TAG, <span class="hljs-string">&quot;Performing launch of &quot;</span> + r);</span><br><span class="line">        <span class="hljs-keyword">if</span> (localLOGV) Slog.v(</span><br><span class="line">                TAG, r + <span class="hljs-string">&quot;: app=&quot;</span> + app</span><br><span class="line">                + <span class="hljs-string">&quot;, appName=&quot;</span> + app.getPackageName()</span><br><span class="line">                + <span class="hljs-string">&quot;, pkg=&quot;</span> + r.packageInfo.getPackageName()</span><br><span class="line">                + <span class="hljs-string">&quot;, comp=&quot;</span> + r.intent.getComponent().toShortString()</span><br><span class="line">                + <span class="hljs-string">&quot;, dir=&quot;</span> + r.packageInfo.getAppDir());</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (activity != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());</span><br><span class="line">            Configuration config = <span class="hljs-keyword">new</span> Configuration(mCompatConfiguration);</span><br><span class="line">            <span class="hljs-keyword">if</span> (r.overrideConfig != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                config.updateFrom(r.overrideConfig);</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">if</span> (DEBUG_CONFIGURATION) Slog.v(TAG, <span class="hljs-string">&quot;Launching activity &quot;</span></span><br><span class="line">                    + r.activityInfo.name + <span class="hljs-string">&quot; with config &quot;</span> + config);</span><br><span class="line">            Window window = <span class="hljs-keyword">null</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (r.mPendingRemoveWindow != <span class="hljs-keyword">null</span> &amp;&amp; r.mPreserveWindow) {</span><br><span class="line">                window = r.mPendingRemoveWindow;</span><br><span class="line">                r.mPendingRemoveWindow = <span class="hljs-keyword">null</span>;</span><br><span class="line">                r.mPendingRemoveWindowManager = <span class="hljs-keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">            appContext.setOuterContext(activity);</span><br><span class="line">            <span class="hljs-comment">// &#x5728;&#x8FD9;&#x91CC;&#x5B8C;&#x6210; Activity &#x6570;&#x636E;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x628A; Activity &#x548C; Context &#x5173;&#x7CFB;&#x8D77;&#x6765;</span></span><br><span class="line">            <span class="hljs-comment">// attach &#x51FD;&#x6570;&#x4E2D;&#x8FD8;&#x4F1A;&#x5B8C;&#x6210; Window &#x7684;&#x521B;&#x5EFA;&#x4EE5;&#x53CA;&#x4E0E; Activity &#x76F8;&#x5173;&#x8054;</span></span><br><span class="line">            activity.attach(appContext, <span class="hljs-keyword">this</span>, getInstrumentation(), r.token,</span><br><span class="line">                    r.ident, app, r.intent, r.activityInfo, title, r.parent,</span><br><span class="line">                    r.embeddedID, r.lastNonConfigurationInstances, config,</span><br><span class="line">                    r.referrer, r.voiceInteractor, window, r.configCallback);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (customIntent != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                activity.mIntent = customIntent;</span><br><span class="line">            }</span><br><span class="line">            r.lastNonConfigurationInstances = <span class="hljs-keyword">null</span>;</span><br><span class="line">            checkAndBlockForNetworkAccess();</span><br><span class="line">            activity.mStartedActivity = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">int</span> theme = r.activityInfo.getThemeResource();</span><br><span class="line">            <span class="hljs-keyword">if</span> (theme != <span class="hljs-number">0</span>) {</span><br><span class="line">                activity.setTheme(theme);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            activity.mCalled = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-comment">// &#x5728;&#x8FD9;&#x91CC; Activity &#x7684; onCreate &#x51FD;&#x6570;&#x6700;&#x7EC8;&#x88AB;&#x8C03;&#x7528;</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (r.isPersistable()) {</span><br><span class="line">                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                mInstrumentation.callActivityOnCreate(activity, r.state);</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">if</span> (!activity.mCalled) {</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SuperNotCalledException(</span><br><span class="line">                    <span class="hljs-string">&quot;Activity &quot;</span> + r.intent.getComponent().toShortString() +</span><br><span class="line">                    <span class="hljs-string">&quot; did not call through to super.onCreate()&quot;</span>);</span><br><span class="line">            }</span><br><span class="line">            r.activity = activity;</span><br><span class="line">            r.stopped = <span class="hljs-keyword">true</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!r.activity.mFinished) {</span><br><span class="line">                activity.performStart();</span><br><span class="line">                r.stopped = <span class="hljs-keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">if</span> (!r.activity.mFinished) {</span><br><span class="line">                <span class="hljs-keyword">if</span> (r.isPersistable()) {</span><br><span class="line">                    <span class="hljs-keyword">if</span> (r.state != <span class="hljs-keyword">null</span> || r.persistentState != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                        mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state,</span><br><span class="line">                                r.persistentState);</span><br><span class="line">                    }</span><br><span class="line">                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r.state != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                    mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">if</span> (!r.activity.mFinished) {</span><br><span class="line">                activity.mCalled = <span class="hljs-keyword">false</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (r.isPersistable()) {</span><br><span class="line">                    mInstrumentation.callActivityOnPostCreate(activity, r.state,</span><br><span class="line">                            r.persistentState);</span><br><span class="line">                } <span class="hljs-keyword">else</span> {</span><br><span class="line">                    mInstrumentation.callActivityOnPostCreate(activity, r.state);</span><br><span class="line">                }</span><br><span class="line">                <span class="hljs-keyword">if</span> (!activity.mCalled) {</span><br><span class="line">                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SuperNotCalledException(</span><br><span class="line">                        <span class="hljs-string">&quot;Activity &quot;</span> + r.intent.getComponent().toShortString() +</span><br><span class="line">                        <span class="hljs-string">&quot; did not call through to super.onPostCreate()&quot;</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        r.paused = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        mActivities.put(r.token, r);</span><br><span class="line"></span><br><span class="line">    } <span class="hljs-keyword">catch</span> (SuperNotCalledException e) {</span><br><span class="line">        <span class="hljs-keyword">throw</span> e;</span><br><span class="line"></span><br><span class="line">    } <span class="hljs-keyword">catch</span> (Exception e) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (!mInstrumentation.onException(activity, e)) {</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="hljs-string">&quot;Unable to start activity &quot;</span> + component</span><br><span class="line">                + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> activity;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><ul>
<li>[1.1 ~ 1.3]&#xFF1A;&#x8FD0;&#x884C;&#x5728;&#x8C03;&#x7528;&#x8005;&#x6240;&#x5728;&#x8FDB;&#x7A0B;&#xFF0C;&#x6BD4;&#x5982;&#x4ECE;&#x684C;&#x9762;&#x542F;&#x52A8;Activity&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x8005;&#x6240;&#x5728;&#x8FDB;&#x7A0B;&#x4E3A;launcher&#x8FDB;&#x7A0B;&#xFF0C;launcher&#x8FDB;&#x7A0B;&#x5229;&#x7528;ActivityManagerService&#x4F5C;&#x4E3A;Binder Client&#xFF0C;&#x8FDB;&#x5165;system_server&#x8FDB;&#x7A0B;(AMS&#x76F8;&#x5E94;&#x7684;Server&#x7AEF;)</li>
<li>[1.4 ~ 2.7]&#xFF1A;&#x8FD0;&#x884C;&#x5728;system_server&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;<ul>
<li>1.6&#xFF1A;<code>resolveActivity()</code> &#x89E3;&#x6790; <code>Intent</code> &#x4E2D;&#x5305;&#x542B;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x521B;&#x5EFA; <code>ActivityRecord</code> &#x5BF9;&#x8C61;</li>
<li>1.7&#xFF1A;&#x7ED9; <code>ActivityRecord</code> &#x8D4B;&#x503C;</li>
<li>1.9&#xFF1A;&#x4E3A;Activity&#x627E;&#x5230;&#x6216;&#x521B;&#x5EFA;&#x65B0;&#x7684;Task&#x5BF9;&#x8C61;&#xFF0C;&#x8BBE;&#x7F6E;flags&#x4FE1;&#x606F;</li>
<li>2.6&#xFF1A;system_server &#x8FDB;&#x7A0B;&#x5229;&#x7528; <code>ApplicationThread&#xFF08;Binder Client&#xFF09;</code> &#x628A;&#x4EFB;&#x52A1;&#x4F20;&#x9012;&#x5230;&#x76EE;&#x6807;&#x8FDB;&#x7A0B;</li>
</ul>
</li>
<li>[2.8 ~ 2.9]&#xFF1A;&#x8FD0;&#x884C;&#x5728;&#x76EE;&#x6807;&#x8FDB;&#x7A0B;&#xFF0C;&#x901A;&#x8FC7;Handler&#x6D88;&#x606F;&#x673A;&#x5236;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;Binder&#x7EBF;&#x7A0B;&#x5411;&#x4E3B;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;H.LAUNCH_ACTIVITY&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x901A;&#x8FC7; <code>Instrumentation#newActivity</code> &#x521B;&#x5EFA;&#x76EE;&#x6807;Activity&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x5165;onCreate()&#x751F;&#x547D;&#x5468;&#x671F;</li>
</ul>
<p><strong>&#x4E0B;&#x56FE;&#x4EE5;&#x53CA;App &#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x6765;&#x81EA;<a href="http://gityuan.com/2016/03/12/start-activity/" target="_blank" rel="noopener">Gityuan &#x535A;&#x5BA2;</a></strong><br><img src="https://image.kangxiaoguang.com/1531362885.png" alt></p>
<p>APP &#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x70B9;&#x51FB;&#x684C;&#x9762;App&#x56FE;&#x6807;&#xFF0C;Launcher&#x8FDB;&#x7A0B;&#x91C7;&#x7528;Binder IPC&#x5411;system_server&#x8FDB;&#x7A0B;&#x53D1;&#x8D77;startActivity&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>system_server&#x8FDB;&#x7A0B;&#x63A5;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x5411;zygote&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x7684;&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>Zygote&#x8FDB;&#x7A0B;fork&#x51FA;&#x65B0;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5373;App&#x8FDB;&#x7A0B;&#xFF1B;</li>
<li>App&#x8FDB;&#x7A0B;&#xFF0C;&#x901A;&#x8FC7;Binder IPC&#x5411;sytem_server&#x8FDB;&#x7A0B;&#x53D1;&#x8D77;attachApplication&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>system_server&#x8FDB;&#x7A0B;&#x5728;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x8FDB;&#x884C;&#x4E00;&#x7CFB;&#x5217;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x540E;&#xFF0C;&#x518D;&#x901A;&#x8FC7;binder IPC&#x5411;App&#x8FDB;&#x7A0B;&#x53D1;&#x9001;scheduleLaunchActivity&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>App&#x8FDB;&#x7A0B;&#x7684;binder&#x7EBF;&#x7A0B;&#xFF08;ApplicationThread&#xFF09;&#x5728;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x901A;&#x8FC7;handler&#x5411;&#x4E3B;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;LAUNCH_ACTIVITY&#x6D88;&#x606F;&#xFF1B;</li>
<li>&#x4E3B;&#x7EBF;&#x7A0B;&#x5728;&#x6536;&#x5230;Message&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x53D1;&#x5C04;&#x673A;&#x5236;&#x521B;&#x5EFA;&#x76EE;&#x6807;Activity&#xFF0C;&#x5E76;&#x56DE;&#x8C03;Activity.onCreate()&#x7B49;&#x65B9;&#x6CD5;GG</li>
</ul>
</body></html>
    
    </div>
    

    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/object-Object/">#[object Object]</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">#读书笔记</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2018/07/11/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AJava-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B/">《Java 并发编程实战》</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2018/05/29/Android/Gradle-%E5%85%A5%E9%97%A8/">Gradle 入门</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5e62ac01d0c39800126ea9e5&amp;product=inline-share-buttons&amp;cms=sop' async='async'></script>

</div>



<div class="comments">
    <h3 class="title is-4">评论</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2018/07/09/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AAndroid-%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B-%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%86%85%E5%AE%B9%E6%80%BB%E7%BB%93/';
        this.page.identifier = '2018/07/09/读书笔记/《Android-开发艺术探索》-第九章内容总结/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'lovedev-org-1' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
</div>


    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 Kevin&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/KevinLoveGitHub" target="_blank" rel="noopener">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>