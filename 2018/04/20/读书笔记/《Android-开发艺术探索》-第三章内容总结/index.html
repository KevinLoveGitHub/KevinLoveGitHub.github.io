<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>《Android 开发艺术探索》- 第三章内容总结 - LoveDev</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="一个踏踏实实的程序员">





    <meta name="description" content="View&amp;#x57FA;&amp;#x7840; TouchSlop&amp;#x7CFB;&amp;#x7EDF;&amp;#x6240;&amp;#x80FD;&amp;#x8BC6;&amp;#x522B;&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x6ED1;&amp;#x52A8;&amp;#x8DDD;&amp;#x79BB;&amp;#xFF0C;ViewConfiguration#getScaledTouchSlop() &amp;#x53EF;&amp;#x4EE5;&amp;#x">
<meta property="og:type" content="article">
<meta property="og:title" content="《Android 开发艺术探索》- 第三章内容总结">
<meta property="og:url" content="http://yoursite.com/2018/04/20/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AAndroid-%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B-%E7%AC%AC%E4%B8%89%E7%AB%A0%E5%86%85%E5%AE%B9%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="LoveDev">
<meta property="og:description" content="View&amp;#x57FA;&amp;#x7840; TouchSlop&amp;#x7CFB;&amp;#x7EDF;&amp;#x6240;&amp;#x80FD;&amp;#x8BC6;&amp;#x522B;&amp;#x7684;&amp;#x6700;&amp;#x5C0F;&amp;#x6ED1;&amp;#x52A8;&amp;#x8DDD;&amp;#x79BB;&amp;#xFF0C;ViewConfiguration#getScaledTouchSlop() &amp;#x53EF;&amp;#x4EE5;&amp;#x">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.kangxiaoguang.com/1524319185.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1524648796.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1524648278.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1524739629.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1524823394.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1525416744.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1525422949.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1525426389.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1525427338.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1527066884.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1528456818.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1528700789.png">
<meta property="og:image" content="https://image.kangxiaoguang.com/1528794924.png">
<meta property="article:published_time" content="2018-04-20T07:46:45.000Z">
<meta property="article:modified_time" content="2020-03-07T06:23:29.044Z">
<meta property="article:author" content="Kevin">
<meta property="article:tag" content="[object Object]">
<meta property="article:tag" content="读书笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.kangxiaoguang.com/1524319185.png">





<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159956718-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-159956718-1');
</script>


    


<meta name="generator" content="Hexo 4.2.1"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    <img src="/favicon.png" alt="" height="28">
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">archives</a>
            
            <a class="navbar-item "
               href="/tags">tags</a>
            
            <a class="navbar-item "
               href="/about">about</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜索" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/KevinLoveGitHub" target="_blank" rel="noopener">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article style="padding-top: 1.5rem!important;" class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            《Android 开发艺术探索》- 第三章内容总结
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2018-04-20T07:46:45.000Z" itemprop="datePublished">4月 20 2018</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 小时 读完 (约 9498 字)
        </span>
        
    </div>

    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><h1 id="View"><a href="#View" class="headerlink" title="View"></a>View</h1><h2 id="&#x57FA;&#x7840;"><a href="#&#x57FA;&#x7840;" class="headerlink" title="&#x57FA;&#x7840;"></a>&#x57FA;&#x7840;</h2><p><img src="https://image.kangxiaoguang.com/1524319185.png" alt></p>
<h3 id="TouchSlop"><a href="#TouchSlop" class="headerlink" title="TouchSlop"></a>TouchSlop</h3><p>&#x7CFB;&#x7EDF;&#x6240;&#x80FD;&#x8BC6;&#x522B;&#x7684;&#x6700;&#x5C0F;&#x6ED1;&#x52A8;&#x8DDD;&#x79BB;&#xFF0C;<code>ViewConfiguration#getScaledTouchSlop()</code> &#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x8BE5;&#x503C;&#xFF0C;<code>frameworks/base/core/res/res/values/config.xml</code> &#x4E2D;&#x7684; <code>config_viewConfigurationTouchSlop</code> &#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x8BE5;&#x503C;</p>
<h3 id="VelocityTracker"><a href="#VelocityTracker" class="headerlink" title="VelocityTracker"></a>VelocityTracker</h3><p>&#x901F;&#x5EA6;&#x8FFD;&#x8E2A;&#xFF0C;&#x7528;&#x4E8E;&#x8FFD;&#x8E2A;&#x624B;&#x673A;&#x6A2A;&#x5411;&#x7AD6;&#x5411;&#x6ED1;&#x52A8;&#x7684;&#x901F;&#x5EA6;</p>
<h3 id="GestureDetector"><a href="#GestureDetector" class="headerlink" title="GestureDetector"></a>GestureDetector</h3><p>&#x624B;&#x52BF;&#x8BC6;&#x522B;</p>
<h3 id="Scroller"><a href="#Scroller" class="headerlink" title="Scroller"></a>Scroller</h3><p>&#x5F39;&#x6027;&#x6ED1;&#x52A8;&#x5BF9;&#x8C61;&#xFF0C;&#x5B9E;&#x73B0; View &#x7684;&#x5F39;&#x6027;&#x6ED1;&#x52A8;</p>
<h2 id="&#x6ED1;&#x52A8;"><a href="#&#x6ED1;&#x52A8;" class="headerlink" title="&#x6ED1;&#x52A8;"></a>&#x6ED1;&#x52A8;</h2><ul>
<li>scrollTo/scrollBy</li>
<li>&#x52A8;&#x753B;</li>
<li>&#x6539;&#x53D8;&#x5E03;&#x5C40;&#x53C2;&#x6570;</li>
</ul>
<h2 id="&#x4E8B;&#x4EF6;&#x4F20;&#x9012;"><a href="#&#x4E8B;&#x4EF6;&#x4F20;&#x9012;" class="headerlink" title="&#x4E8B;&#x4EF6;&#x4F20;&#x9012;"></a>&#x4E8B;&#x4EF6;&#x4F20;&#x9012;</h2><p><strong>boolean dispatchTouchEvent (MotionEvent ev)</strong><br>&#x5982;&#x679C;&#x4E8B;&#x4EF6;&#x4F20;&#x9012;&#x5230;&#x5F53;&#x524D;&#x7684; View&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E00;&#x5B9A;&#x4F1A;&#x8C03;&#x7528;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x53D7;&#x5230;&#x5F53;&#x524D; View &#x7684; onTouchEvent() &#x548C;&#x5B50; View &#x7684; dispatchTouchEvent() &#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x8868;&#x793A;&#x662F;&#x5426;&#x6D88;&#x8017;&#x5F53;&#x524D;&#x4E8B;&#x4EF6;</p>
<p><strong>boolean onInterceptTouchEvent (MotionEvent ev)</strong><br>dispatchTouchEvent() &#x4E2D;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#xFF0C;&#x8868;&#x793A;&#x662F;&#x5426;&#x62E6;&#x622A;&#x5F53;&#x524D;&#x4E8B;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D; ViewGroup &#x62E6;&#x622A;&#x4E86;&#x8BE5;&#x4E8B;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x540C;&#x4E00;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#xFF0C;&#x4E0D;&#x4F1A;&#x518D;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;</p>
<p><strong>boolean onTouchEvent (MotionEvent ev)</strong><br>dispatchTouchEvent() &#x4E2D;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#xFF0C;&#x8868;&#x793A;&#x662F;&#x5426;&#x6D88;&#x8D39;&#x5F53;&#x524D;&#x4E8B;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; true&#xFF0C;&#x8FD4;&#x56DE; true &#x8868;&#x793A;&#x6D88;&#x8017;&#xFF0C;false &#x8868;&#x793A;&#x6D88;&#x8017;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x6D88;&#x8017;&#xFF0C;&#x8BE5; View &#x5C06;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x540C;&#x4E00;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;</p>
<p><img src="https://image.kangxiaoguang.com/1524648796.png" alt></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">dispatchTouchEvent</span><span class="hljs-params">(MotionEvent event)</span></span>{</span><br><span class="line">    <span class="hljs-keyword">boolean</span> consume = <span class="hljs-keyword">false</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (onInterceptTouchEvent(event)){</span><br><span class="line">        consume = onTouchEvent(event);</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        consume = child.dispatchTouchEvent(event);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> consume;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li>&#x5982;&#x679C; View &#x8BBE;&#x7F6E;&#x4E86; onTouchEventListener()&#xFF0C;&#x53EA;&#x6709; onTouchEventListener() &#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F; false &#x624D;&#x6267;&#x884C; view &#x7684; onTouchEvent()&#xFF0C; onTouchEventListener() &#x7684;&#x4F18;&#x5148;&#x7EA7;&#x6BD4; onTouchEvent() &#x4F18;&#x5148;&#x7EA7;&#x8981;&#x9AD8;&#xFF0C;onClickListener() &#x4F18;&#x5148;&#x7EA7;&#x6700;&#x4F4E;</li>
<li>ViewGroup &#x7684; onInterceptTouchEvent() &#x65B9;&#x6CD5;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;&#x8FD4;&#x56DE; true &#x62E6;&#x622A;&#x4E4B;&#x540E;&#xFF0C;&#x540C;&#x4E00;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#x540E;&#x7EED;&#x7684;&#x4E8B;&#x4EF6;&#x5C06;&#x90FD;&#x4EA4;&#x7ED9;&#x8BE5; ViewGroup &#x5904;&#x7406;&#xFF0C;&#x4E14;&#x4E0D;&#x4F1A;&#x8C03;&#x7528; onInterceptTouchEvent()&#x3002;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;&#x5DF2;&#x7ECF;&#x62E6;&#x622A;&#x4E86;&#x8BE5;&#x4E8B;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x540E;&#x7EED;&#x4E8B;&#x4EF6;&#x81EA;&#x7136;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x8BE2;&#x95EE;&#x662F;&#x5426;&#x62E6;&#x622A;</li>
<li>&#x540C;&#x4E00;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#xFF0C;&#x5982;&#x679C; View &#x4E0D;&#x6D88;&#x8017; ACTION_DOWN &#x4E8B;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#x5176;&#x4ED6;&#x4E8B;&#x4EF6;&#x90FD;&#x5C06;&#x4E0D;&#x4F1A;&#x4EA4;&#x7ED9;&#x8BE5; View &#x5904;&#x7406;&#x3002;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x7406;&#x89E3;&#xFF1A;&#x9886;&#x5BFC;&#x60F3;&#x8BA9;&#x4F60;&#x505A;&#x70B9;&#x524D;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8BF4;&#x4F60;&#x4E0D;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x518D;&#x6709;&#x524D;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x518D;&#x627E;&#x4F60;</li>
<li>&#x5982;&#x679C; onTouchEvent() &#x53EA;&#x6D88;&#x8017;&#x4E86; ACTION_DOWN &#x4E8B;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x4ED6;&#x4E8B;&#x4EF6;&#x4E0D;&#x4F1A;&#x4E0A;&#x4F20;&#x5230;&#x7236; View &#x7684; onTouchEvent() &#x4E2D;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5; View &#x8FD8;&#x4F1A;&#x63A5;&#x6536;&#x5230;&#x5176;&#x4F59;&#x4E8B;&#x4EF6;&#x3002;&#x6700;&#x7EC8;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x90FD;&#x4F1A;&#x7531; Activity &#x5904;&#x7406;</li>
<li>ViewGroup &#x9ED8;&#x8BA4;&#x4E0D;&#x62E6;&#x622A;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;&#xFF0C;&#x6E90;&#x7801;&#x4E2D; ViewGroup &#x7684; onInterceptTouchEvent() &#x9ED8;&#x8BA4;&#x8FD4;&#x56DE; false</li>
<li>View &#x6CA1;&#x6709; onInterceptTouchEvent() &#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x4E8B;&#x4EF6;&#x4F20;&#x9012;&#x5230; View &#x76F4;&#x63A5;&#x5C31;&#x8C03;&#x7528; onTouchEvent()</li>
<li>View &#x7684; onTouchEvent() &#x51FD;&#x6570;&#x9ED8;&#x8BA4;&#x6D88;&#x8017;&#x4E8B;&#x4EF6;&#xFF0C;&#x9664;&#x975E;&#x8BE5; View &#x662F;&#x4E0D;&#x53EF;&#x70B9;&#x51FB;&#x7684;</li>
<li>View &#x7684; enable &#x548C; disable &#x5C5E;&#x6027;&#x4E0D;&#x5F71;&#x54CD; onTouchEvent() &#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x53EA;&#x8981;&#x8BE5; View &#x7684; clickable &#x6216;&#x8005; longClickable &#x6709;&#x4E00;&#x4E2A;&#x4E3A; true&#xFF0C;&#x90A3;&#x4E48; onTouchEvent() &#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x4E3A; true</li>
<li>View &#x7684; clickable &#x548C; longClickable &#x90FD;&#x4E3A; false &#x65F6;&#xFF0C;onTouchEvent() &#x8FD4;&#x56DE; false&#xFF0C;dispatchTouchEvent() &#x4E5F;&#x8FD4;&#x56DE; false&#xFF0C;View &#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x63A5;&#x6536;&#x540E;&#x7EED;&#x7684;&#x4E8B;&#x4EF6;</li>
<li>onClick() &#x53D1;&#x751F;&#x7684;&#x524D;&#x63D0;&#x662F; View &#x53EF;&#x70B9;&#x51FB;&#xFF0C;&#x5E76;&#x4E14;&#x6536;&#x5230;&#x4E86; ACTION_DOWN &#x548C; ACTION_UP &#x4E24;&#x4E2A;&#x4E8B;&#x4EF6;</li>
<li>&#x4E8B;&#x4EF6;&#x7684;&#x4F20;&#x9012;&#x603B;&#x662F;&#x7531;&#x5916;&#x5411;&#x5185;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x90FD;&#x4F1A;&#x5148;&#x4F20;&#x9012;&#x7ED9;&#x7236;&#x5143;&#x7D20;&#xFF0C;&#x7531;&#x7236;&#x5143;&#x7D20;&#x5206;&#x53D1;&#x7ED9;&#x5B50;&#x5143;&#x7D20;&#x3002;&#x5728;&#x5B50;&#x5143;&#x7D20;&#x91CC;&#x9762;&#x53EF;&#x4EE5;&#x8C03;&#x7528; requestDisallowInterceptTouchEvent() &#x5E72;&#x9884;&#x7236;&#x5143;&#x7D20;&#x7684;&#x5206;&#x53D1;&#xFF0C;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x963B;&#x6B62;&#x7236;&#x5143;&#x7D20;&#x4F7F;&#x7528;onInterceptTouchEvent() &#x51FD;&#x6570;&#x62E6;&#x622A;&#x4E8B;&#x4EF6;&#xFF0C;&#x4F46;&#x662F; ACTION_DOWN &#x9664;&#x5916;</li>
</ul>
<h3 id="&#x6E90;&#x7801;&#x5206;&#x6790;"><a href="#&#x6E90;&#x7801;&#x5206;&#x6790;" class="headerlink" title="&#x6E90;&#x7801;&#x5206;&#x6790;"></a>&#x6E90;&#x7801;&#x5206;&#x6790;</h3><p>&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x9996;&#x5148;&#x4F1A;&#x4F20;&#x9012;&#x7684; <code>Activity#dispatchKeyEvent</code> &#x4E2D;&#xFF0C;&#x5185;&#x90E8;&#x8C03;&#x7528; <code>Window#superDispatchKeyEvent</code> &#x8FDB;&#x884C;&#x4E8B;&#x4EF6;&#x5206;&#x53D1;&#xFF0C;&#x800C; Window &#x662F;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x7C7B; PhoneWindow&#xFF0C;&#x6B64;&#x65F6;&#x5C31;&#x4F1A;&#x6267;&#x884C; <code>PhoneWindow#superDispatchKeyEvent</code> &#x8FDB;&#x884C;&#x4E8B;&#x4EF6;&#x7684;&#x5206;&#x53D1;&#xFF0C;&#x5728; <code>PhoneWindow#superDispatchKeyEvent</code> &#x4E2D;&#x8C03;&#x7528;&#x4E86; <code>DecorView#superDispatchTouchEvent</code>&#xFF0C;&#x800C; <code>DecorView#superDispatchTouchEvent</code> &#x53C8;&#x8C03;&#x7528;&#x4E86; <code>super.dispatchTouchEvent</code>&#xFF0C;&#x7531;&#x4E8E;DecorView &#x7EE7;&#x627F;&#x4E86; FrameLayout&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6267;&#x884C;&#x7684;&#x662F; <code>ViewGroup#dispatchTouchEvent</code></p>
<p>&#x5176;&#x4E2D; DecorView &#x662F;&#x5F53;&#x524D; Activity &#x7684;&#x5E95;&#x5C42;&#x5BB9;&#x5668;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; setContentView &#x6240;&#x8BBE;&#x7F6E; View &#x7684;&#x7236;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>Activity.getWindow().getDecorView()</code> &#x83B7;&#x53D6;&#xFF0C;&#x901A;&#x8FC7; <code>DecorView.findViewById(R.id.content).getChildAt(0)</code> &#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5F53;&#x524D; Activity &#x901A;&#x8FC7; setContentView &#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x90A3;&#x4E2A; View &#x5BF9;&#x8C61;</p>
<p>&#x4ECE; <code>ViewGroup#dispatchTouchEvent</code> &#x5F00;&#x59CB;&#xFF0C;&#x4E8B;&#x4EF6;&#x5DF2;&#x7ECF;&#x4F20;&#x9012;&#x5230;&#x4E86;&#x901A;&#x8FC7; setContentView &#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x90A3;&#x4E2A; View &#x5BF9;&#x8C61;&#x7684; dispatchTouchEvent() &#x4E2D;</p>
<p><img src="https://image.kangxiaoguang.com/1524648278.png" alt></p>
<h4 id="ViewGroup"><a href="#ViewGroup" class="headerlink" title="ViewGroup"></a>ViewGroup</h4><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Handle an initial down.</span></span><br><span class="line"><span class="hljs-comment">// &#x8FD9;&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x89E3;&#x6790;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x5B50; View &#x8C03;&#x7528; requestDisallowInterceptTouchEvent &#x540E;&#x5BF9; ACTION_DOWN &#x4E0D;&#x751F;&#x6548;</span></span><br><span class="line"><span class="hljs-comment">// &#x56E0;&#x4E3A;&#x5982;&#x679C;&#x662F; ACTION_DOWN &#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x91CD;&#x65B0;&#x590D;&#x5236; mGroupFlags</span></span><br><span class="line"><span class="hljs-keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) {</span><br><span class="line">    <span class="hljs-comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">    <span class="hljs-comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">    <span class="hljs-comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">    cancelAndClearTouchTargets(ev);</span><br><span class="line">    resetTouchState();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Check for interception.</span></span><br><span class="line"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> intercepted;</span><br><span class="line"><span class="hljs-comment">// &#x5982;&#x679C; action &#x4E3A; ACTION_DOWN &#x6216;&#x8005; mFirstTouchTarget &#x4E0D;&#x4E3A;&#x7A7A;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528; ViewGroup#onInterceptTouchEvent</span></span><br><span class="line"><span class="hljs-comment">// &#x5F53; ViewGroup &#x7684;&#x5B50; View &#x6D88;&#x8D39;&#x4E86;&#x4E8B;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x628A;&#x8BE5; View &#x8D4B;&#x503C;&#x7ED9; mFirstTouchTarget</span></span><br><span class="line"><span class="hljs-comment">// &#x5982;&#x679C;&#x662F; ViewGroup &#x6D88;&#x8D39;&#x4E86;&#x4E8B;&#x4EF6;&#xFF0C;mFirstTouchTarget &#x5219;&#x4E0D;&#x4F1A;&#x88AB;&#x8D4B;&#x503C;</span></span><br><span class="line"><span class="hljs-comment">// &#x6240;&#x4EE5;&#x5F53; ViewGroup &#x7684; onInterceptTouchEvent &#x8FD4;&#x56DE;&#x503C;&#x4E3A; true &#x65F6;&#xFF0C;&#x540E;&#x7EED;&#x4E8B;&#x4EF6;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x8C03;&#x7528; onInterceptTouchEvent</span></span><br><span class="line"><span class="hljs-keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">        || mFirstTouchTarget != <span class="hljs-keyword">null</span>) {</span><br><span class="line">    <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x7684; mGroupFlags &#x5C31;&#x662F;&#x88AB;&#x5B50; View &#x8C03;&#x7528; requestDisallowInterceptTouchEvent &#x8BBE;&#x7F6E;&#x7684;</span></span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!disallowIntercept) {</span><br><span class="line">        intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">        ev.setAction(action); <span class="hljs-comment">// restore action in case it was changed</span></span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        intercepted = <span class="hljs-keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">} <span class="hljs-keyword">else</span> {</span><br><span class="line">    <span class="hljs-comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">    <span class="hljs-comment">// so this view group continues to intercept touches.</span></span><br><span class="line">    intercepted = <span class="hljs-keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-comment">// &#x627E;&#x5230;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x7684; View</span></span><br><span class="line">View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()</span><br><span class="line">        ? findChildWithAccessibilityFocus() : <span class="hljs-keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// &#x5904;&#x7406;&#x4E8B;&#x4EF6;</span></span><br><span class="line"><span class="hljs-keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">        || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">        || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {</span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> actionIndex = ev.getActionIndex(); <span class="hljs-comment">// always 0 for down</span></span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> idBitsToAssign = split ? <span class="hljs-number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</span><br><span class="line">            : TouchTarget.ALL_POINTER_IDS;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Clean up earlier touch targets for this pointer id in case they</span></span><br><span class="line">    <span class="hljs-comment">// have become out of sync.</span></span><br><span class="line">    <span class="hljs-comment">// &#x79FB;&#x9664;&#x4E0A;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x4E8B;&#x4EF6;&#x7684; View</span></span><br><span class="line">    removePointersFromTouchTargets(idBitsToAssign);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> childrenCount = mChildrenCount;</span><br><span class="line">    <span class="hljs-keyword">if</span> (newTouchTarget == <span class="hljs-keyword">null</span> &amp;&amp; childrenCount != <span class="hljs-number">0</span>) {</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> x = ev.getX(actionIndex);</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> y = ev.getY(actionIndex);</span><br><span class="line">        <span class="hljs-comment">// Find a child that can receive the event.</span></span><br><span class="line">        <span class="hljs-comment">// Scan children from front to back.</span></span><br><span class="line">        <span class="hljs-comment">// &#x83B7;&#x53D6;&#x80FD;&#x6536;&#x5230;&#x4E8B;&#x4EF6;&#x7684;&#x5B50; View</span></span><br><span class="line">        <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> customOrder = preorderedList == <span class="hljs-keyword">null</span></span><br><span class="line">                &amp;&amp; isChildrenDrawingOrderEnabled();</span><br><span class="line">        <span class="hljs-keyword">final</span> View[] children = mChildren;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = childrenCount - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {</span><br><span class="line">            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> childIndex = getAndVerifyPreorderedIndex(</span><br><span class="line">                    childrenCount, i, customOrder);</span><br><span class="line">            <span class="hljs-keyword">final</span> View child = getAndVerifyPreorderedView(</span><br><span class="line">                    preorderedList, children, childIndex);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// If there is a view that has accessibility focus we want it</span></span><br><span class="line">            <span class="hljs-comment">// to get the event first and if not handled we will perform a</span></span><br><span class="line">            <span class="hljs-comment">// normal dispatch. We may do a double iteration but this is</span></span><br><span class="line">            <span class="hljs-comment">// safer given the timeframe.</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (childWithAccessibilityFocus != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                <span class="hljs-keyword">if</span> (childWithAccessibilityFocus != child) {</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                }</span><br><span class="line">                childWithAccessibilityFocus = <span class="hljs-keyword">null</span>;</span><br><span class="line">                i = childrenCount - <span class="hljs-number">1</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// &#x5224;&#x65AD;&#x5143;&#x7D20;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4E8B;&#x4EF6;&#x4EE5;&#x53CA;&#x4E8B;&#x4EF6;&#x5750;&#x6807;&#x662F;&#x5426;&#x5728;&#x5143;&#x7D20;&#x5185;</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (!canViewReceivePointerEvents(child)</span><br><span class="line">                    || !isTransformedTouchPointInView(x, y, child, <span class="hljs-keyword">null</span>)) {</span><br><span class="line">                ev.setTargetAccessibilityFocus(<span class="hljs-keyword">false</span>);</span><br><span class="line">                <span class="hljs-keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            newTouchTarget = getTouchTarget(child);</span><br><span class="line">            <span class="hljs-keyword">if</span> (newTouchTarget != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                <span class="hljs-comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                <span class="hljs-comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            resetCancelNextUpFlag(child);</span><br><span class="line">            <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x5C31;&#x4E8B;&#x4EF6;&#x4EA4;&#x7ED9;&#x4E86;&#x5B50; View &#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x7EE7;&#x7EED;&#x4E0B;&#x4E2A;&#x5FAA;&#x73AF;</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="hljs-keyword">false</span>, child, idBitsToAssign)) {</span><br><span class="line">                <span class="hljs-comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                <span class="hljs-keyword">if</span> (preorderedList != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                    <span class="hljs-comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; childrenCount; j++) {</span><br><span class="line">                        <span class="hljs-keyword">if</span> (children[childIndex] == mChildren[j]) {</span><br><span class="line">                            mLastTouchDownIndex = j;</span><br><span class="line">                            <span class="hljs-keyword">break</span>;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                } <span class="hljs-keyword">else</span> {</span><br><span class="line">                    mLastTouchDownIndex = childIndex;</span><br><span class="line">                }</span><br><span class="line">                mLastTouchDownX = ev.getX();</span><br><span class="line">                mLastTouchDownY = ev.getY();</span><br><span class="line">                <span class="hljs-comment">// &#x5982;&#x679C;&#x5B50; View &#x7684; dispatchTouchEvent &#x8FD4;&#x56DE;&#x4E86; true&#xFF0C;&#x5C31;&#x5728; addTouchTarget &#x4E2D;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E; mFirstTouchTarget &#x7684;&#x503C;</span></span><br><span class="line">                newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                alreadyDispatchedToNewTouchTarget = <span class="hljs-keyword">true</span>;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// The accessibility focus didn&apos;t handle the event, so clear</span></span><br><span class="line">            <span class="hljs-comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">            ev.setTargetAccessibilityFocus(<span class="hljs-keyword">false</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (preorderedList != <span class="hljs-keyword">null</span>) preorderedList.clear();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (newTouchTarget == <span class="hljs-keyword">null</span> &amp;&amp; mFirstTouchTarget != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        <span class="hljs-comment">// Did not find a child to receive the event.</span></span><br><span class="line">        <span class="hljs-comment">// Assign the pointer to the least recently added target.</span></span><br><span class="line">        newTouchTarget = mFirstTouchTarget;</span><br><span class="line">        <span class="hljs-keyword">while</span> (newTouchTarget.next != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            newTouchTarget = newTouchTarget.next;</span><br><span class="line">        }</span><br><span class="line">        newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://image.kangxiaoguang.com/1524739629.png" alt></p>
<h4 id="View-dispatchTouchEvent"><a href="#View-dispatchTouchEvent" class="headerlink" title="View#dispatchTouchEvent"></a>View#dispatchTouchEvent</h4><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (onFilterTouchEventForSecurity(event)) {</span><br><span class="line">    <span class="hljs-keyword">if</span> ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) {</span><br><span class="line">        result = <span class="hljs-keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">    <span class="hljs-comment">// &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86; onToucheListener&#xFF0C;&#x5E76;&#x4E14; onTouch &#x8FD4;&#x56DE;&#x4E86; true&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x8C03;&#x7528; onTouchEvent</span></span><br><span class="line">    ListenerInfo li = mListenerInfo;</span><br><span class="line">    <span class="hljs-keyword">if</span> (li != <span class="hljs-keyword">null</span> &amp;&amp; li.mOnTouchListener != <span class="hljs-keyword">null</span></span><br><span class="line">            &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</span><br><span class="line">            &amp;&amp; li.mOnTouchListener.onTouch(<span class="hljs-keyword">this</span>, event)) {</span><br><span class="line">        result = <span class="hljs-keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) {</span><br><span class="line">        result = <span class="hljs-keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="View-onTouchEvent"><a href="#View-onTouchEvent" class="headerlink" title="View#onTouchEvent"></a>View#onTouchEvent</h4><p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE</span><br><span class="line">                || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)</span><br><span class="line">                || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> ((viewFlags &amp; ENABLED_MASK) == DISABLED) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != <span class="hljs-number">0</span>) {</span><br><span class="line">        setPressed(<span class="hljs-keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">    mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</span><br><span class="line">    <span class="hljs-comment">// A disabled view that is clickable still consumes the touch</span></span><br><span class="line">    <span class="hljs-comment">// events, it just doesn&apos;t respond to them.</span></span><br><span class="line">    <span class="hljs-comment">// &#x7981;&#x7528;&#x72B6;&#x6001;&#x4E0B;&#x7684; View&#xFF0C;&#x4F9D;&#x7136;&#x4F1A;&#x6D88;&#x8D39;&#x4E8B;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x4F1A;&#x505A;&#x51FA;&#x54CD;&#x5E94;</span></span><br><span class="line">    <span class="hljs-comment">// &#x5982;&#x679C; CLICKABLE &#x548C; LONG_CLICKABLE &#x6709;&#x4E00;&#x4E2A;&#x4E3A; true&#xFF0C;onTouchEvent &#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x662F; true</span></span><br><span class="line">    <span class="hljs-keyword">return</span> clickable;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (!focusTaken) {</span><br><span class="line">    <span class="hljs-comment">// Use a Runnable and post this rather than calling</span></span><br><span class="line">    <span class="hljs-comment">// performClick directly. This lets other visual state</span></span><br><span class="line">    <span class="hljs-comment">// of the view update before click actions start.</span></span><br><span class="line">    <span class="hljs-comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Runnable &#x653E;&#x5165;&#x5230;&#x6D88;&#x606F;&#x6C60;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6DFB;&#x52A0;&#x5931;&#x8D25;&#x5C31;&#x76F4;&#x63A5;&#x6267;&#x884C; performClick()</span></span><br><span class="line">    <span class="hljs-comment">// performClick() &#x5185;&#x90E8;&#x4F1A;&#x8C03;&#x7528; onClickListener.onClick()</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (mPerformClick == <span class="hljs-keyword">null</span>) {</span><br><span class="line">        mPerformClick = <span class="hljs-keyword">new</span> PerformClick();</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span> (!post(mPerformClick)) {</span><br><span class="line">        performClick();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://image.kangxiaoguang.com/1524823394.png" alt></p>
<h2 id="&#x6ED1;&#x52A8;&#x51B2;&#x7A81;"><a href="#&#x6ED1;&#x52A8;&#x51B2;&#x7A81;" class="headerlink" title="&#x6ED1;&#x52A8;&#x51B2;&#x7A81;"></a>&#x6ED1;&#x52A8;&#x51B2;&#x7A81;</h2><p>&#x6ED1;&#x52A8;&#x51B2;&#x7A81;&#x9700;&#x8981;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x7684;&#x4E1A;&#x52A1;&#x9700;&#x6C42;&#x4EE5;&#x53CA;&#x4E0D;&#x540C;&#x7684;&#x573A;&#x666F;&#x8FDB;&#x884C;&#x9488;&#x5BF9;&#x6027;&#x89E3;&#x51B3;&#xFF0C;&#x6CA1;&#x6709;&#x4E00;&#x5957;&#x6807;&#x51C6;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5217;&#x4E3E;&#x4E00;&#x4E0B;&#x5E38;&#x89C1;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>
<h3 id="&#x5916;&#x90E8;&#x62E6;&#x622A;"><a href="#&#x5916;&#x90E8;&#x62E6;&#x622A;" class="headerlink" title="&#x5916;&#x90E8;&#x62E6;&#x622A;"></a>&#x5916;&#x90E8;&#x62E6;&#x622A;</h3><p>&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x90FD;&#x4F1A;&#x5148;&#x4EA4;&#x7ED9;&#x5916;&#x90E8;&#x5143;&#x7D20;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x7684;&#x4E1A;&#x52A1;&#x5224;&#x65AD;&#x662F;&#x7531;&#x5916;&#x90E8;&#x5143;&#x7D20;&#x5904;&#x7406;&#x8FD8;&#x662F;&#x4EA4;&#x7ED9;&#x5185;&#x90E8;&#x5143;&#x7D20;&#x5904;&#x7406;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onInterceptTouchEvent</span><span class="hljs-params">(MotionEvent ev)</span> </span>{</span><br><span class="line">    Log.d(TAG, <span class="hljs-string">&quot;onInterceptTouchEvent&quot;</span>);</span><br><span class="line">    <span class="hljs-comment">// &#x6B64;&#x5904;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x4EE5;&#x53CA;&#x573A;&#x666F;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x62E6;&#x622A;&#x4E8B;&#x4EF6;</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> needIntercept = <span class="hljs-keyword">true</span>;</span><br><span class="line">    <span class="hljs-keyword">boolean</span> intercept = <span class="hljs-keyword">false</span>;</span><br><span class="line">    <span class="hljs-keyword">switch</span> (ev.getAction()) {</span><br><span class="line">        <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">            <span class="hljs-comment">// &#x56E0;&#x4E3A;&#x5982;&#x679C; ACTION_DOWN &#x4E8B;&#x4EF6;&#x62E6;&#x622A;&#x4E4B;&#x540E;&#xFF0C;&#x540C;&#x4E00;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x4E8B;&#x4EF6;&#x53EA;&#x4F1A;&#x4EA4;&#x7ED9;&#x8BE5; ViewGroup &#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x80FD;&#x8FD4;&#x56DE; false</span></span><br><span class="line">            intercept = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">            <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x5FC5;&#x987B;&#x8981;&#x8FD4;&#x56DE; false&#xFF0C;&#x56E0;&#x4E3A;ViewGroup &#x53EA;&#x8981;&#x62E6;&#x622A;&#x4E86;&#x4EFB;&#x4F55;&#x4E8B;&#x4EF6;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x4E8B;&#x4EF6;&#x4E5F;&#x53EA;&#x4F1A;&#x4EA4;&#x7ED9;&#x4ED6;&#x5904;&#x7406;</span></span><br><span class="line">            <span class="hljs-comment">// &#x5982;&#x679C;&#x5728;&#x6CA1;&#x6709;&#x62E6;&#x622A; ACTION_MOVE &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD4;&#x56DE;&#x4E86; true&#xFF0C;&#x5B50; View &#x7684; click &#x4E8B;&#x4EF6;&#x5C06;&#x4E0D;&#x4F1A;&#x6267;&#x884C;</span></span><br><span class="line">            intercept = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">            intercept = needIntercept;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">            <span class="hljs-keyword">default</span>:</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> intercept;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="&#x5185;&#x90E8;&#x62E6;&#x622A;"><a href="#&#x5185;&#x90E8;&#x62E6;&#x622A;" class="headerlink" title="&#x5185;&#x90E8;&#x62E6;&#x622A;"></a>&#x5185;&#x90E8;&#x62E6;&#x622A;</h3><p>&#x5916;&#x90E8;&#x5143;&#x7D20;&#x9ED8;&#x8BA4;&#x62E6;&#x622A;&#x9664;&#x4E86; ACTION_DOWN &#x5916;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#xFF0C;&#x7531;&#x5185;&#x90E8;&#x5143;&#x7D20;&#x8C03;&#x7528;<code>requestDisallowInterceptTouchEvent</code> &#x6765;&#x63A7;&#x5236;&#x5916;&#x90E8;&#x5143;&#x7D20;&#x662F;&#x5426;&#x62E6;&#x622A;&#x4E8B;&#x4EF6;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">dispatchTouchEvent</span><span class="hljs-params">(MotionEvent ev)</span> </span>{</span><br><span class="line">    Log.d(TAG, <span class="hljs-string">&quot;dispatchTouchEvent&quot;</span>);</span><br><span class="line">    <span class="hljs-comment">// &#x6B64;&#x5904;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x4EE5;&#x53CA;&#x573A;&#x666F;&#x5224;&#x65AD;&#x5916;&#x90E8;&#x5143;&#x7D20;&#x662F;&#x5426;&#x8981;&#x62E6;&#x622A;&#x4E8B;&#x4EF6;</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> parentNeedIntercept = <span class="hljs-keyword">true</span>;</span><br><span class="line">    <span class="hljs-keyword">switch</span> (ev.getAction()) {</span><br><span class="line">        <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">            <span class="hljs-comment">// &#x4E0D;&#x5141;&#x8BB8;&#x7236;&#x5143;&#x7D20;&#x62E6;&#x622A; ACTION_DOWN</span></span><br><span class="line">            <span class="hljs-keyword">this</span>.requestDisallowInterceptTouchEvent(<span class="hljs-keyword">true</span>);</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">            <span class="hljs-comment">// ACTION_UP &#x4E8B;&#x4EF6;&#x4E0D;&#x7528;&#x5904;&#x7406;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x81EA;&#x52A8;&#x4EA4;&#x7ED9;&#x62E6;&#x622A; ACTION_MOVE &#x4E8B;&#x4EF6;&#x7684;&#x5143;&#x7D20;&#x5904;&#x7406;</span></span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">            <span class="hljs-comment">// &#x4E0D;&#x5141;&#x8BB8;&#x7236;&#x5143;&#x7D20;&#x62E6;&#x622A; ACTION_MOVE</span></span><br><span class="line">            <span class="hljs-keyword">this</span>.requestDisallowInterceptTouchEvent(parentNeedIntercept);</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        <span class="hljs-keyword">default</span>:</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="MeasureSpec"><a href="#MeasureSpec" class="headerlink" title="MeasureSpec"></a>MeasureSpec</h2><p>ViewRoot &#x5BF9;&#x5E94; ViewRootImpl &#x7C7B;&#xFF0C;&#x662F;&#x8FDE;&#x63A5; WindowManager &#x548C; DecorView&#xFF0C;View &#x7684;&#x4E09;&#x5927;&#x6D41;&#x7A0B;&#x90FD;&#x7531; ViewRoot &#x5B8C;&#x6210;&#xFF0C;&#x5F53; Activity &#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#x5B8C;&#x6BD5;&#x540E;&#x8C03;&#x7528; <code>setContentView()</code> &#x65F6;&#xFF0C;&#x4F1A;&#x5C06; DecorView &#x6DFB;&#x52A0;&#x5230; Window &#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x521B;&#x5EFA; ViewRootImpl &#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x5C06; ViewRootImpl &#x5BF9;&#x8C61;&#x548C; DecorView &#x5EFA;&#x7ACB;&#x5173;&#x8054;</p>
<p><img src="https://image.kangxiaoguang.com/1525416744.png" alt></p>
<p>View &#x7684;&#x7ED8;&#x5236;&#x6D41;&#x7A0B;&#x4ECE; ViewRoot &#x7684; <code>performTraversals</code> &#x5F00;&#x59CB;&#xFF0C;&#x4F9D;&#x6B21;&#x8C03;&#x7528; <code>performMeasure</code>&#x3001;<code>performLayout</code>&#x3001;<code>performDraw</code> &#x3002;</p>
<p>&#x8C03;&#x7528; <code>performMeasure</code> &#x65F6;&#x4F1A;&#x8C03;&#x7528; <code>measure</code>&#xFF0C;<code>measure</code> &#x4E2D;&#x53C8;&#x4F1A;&#x8C03;&#x7528; <code>onMeasure</code>&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5B50; View &#x5B58;&#x5728;&#xFF0C;&#x5728; <code>onMeasure</code> &#x4E2D;&#x4F1A;&#x904D;&#x5386;&#x5B50; View &#x5E76;&#x8C03;&#x7528;&#x5176; <code>measure</code>&#xFF0C;&#x8FD9;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x6B21; Measure &#x8FC7;&#x7A0B;&#xFF0C;Layout &#x548C; Draw &#x8FC7;&#x7A0B;&#x548C; Measure &#x7C7B;&#x4F3C;&#xFF0C;&#x6CA1;&#x6709;&#x672C;&#x8D28;&#x4E0A;&#x7684;&#x533A;&#x522B;</p>
<p>MeasureSpec &#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x51B3;&#x5B9A; View &#x7684;&#x6D4B;&#x91CF;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E4B;&#x6240;&#x4EE5;&#x662F;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x5F71;&#x54CD;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x8FD8;&#x53D7;&#x5230;&#x7236;&#x5BB9;&#x5668;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x5728;&#x6D4B;&#x91CF;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;View &#x7684; LayoutParams &#x4EE5;&#x53CA;&#x7236;&#x5BB9;&#x5668;&#x6240;&#x65BD;&#x52A0;&#x7684;&#x89C4;&#x5219;&#x51B3;&#x5B9A;&#x4E86; MeasureSpec&#xFF0C;&#x5229;&#x7528; MeasureSpec &#x6D4B;&#x91CF;&#x51FA; View &#x7684;&#x5BBD;&#x9AD8;</p>
<p>&#x5BF9;&#x4E8E;&#x9876;&#x7EA7; DecorView&#xFF0C;&#x5176; MeasureSpec &#x7531;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x5927;&#x5C0F;&#x548C;&#x81EA;&#x8EAB;&#x7684; LayoutParams &#x51B3;&#x5B9A;&#xFF0C;&#x5176;&#x4ED6;&#x7684; View &#x90FD;&#x662F;&#x7531;&#x7236;&#x5BB9;&#x5668;&#x7684; MeasureSpec &#x548C;&#x81EA;&#x8EAB;&#x7684; LayoutParams &#x51B3;&#x5B9A;</p>
<p><img src="https://image.kangxiaoguang.com/1525422949.png" alt></p>
<p>MeasureSpec &#x4EE3;&#x8868;&#x4E00;&#x4E2A;32&#x4F4D;&#x7684; int &#x503C;&#xFF0C;&#x9AD8;2&#x4F4D;&#x4EE3;&#x8868; SpecMode&#xFF0C;&#x4F4E;30&#x4F4D;&#x4EE3;&#x8868; SpecSize&#xFF0C;SpecMode &#x4EE3;&#x8868;&#x6D4B;&#x91CF;&#x6A21;&#x5F0F;&#xFF0C;SpecSize &#x4EE3;&#x8868;&#x67D0;&#x79CD;&#x6D4B;&#x91CF;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x89C4;&#x683C;&#x5927;&#x5C0F;</p>
<p>SpecMode &#x6709;&#x4E09;&#x7C7B;&#xFF1A;</p>
<ul>
<li><strong>UNSPECIFIED</strong>&#xFF1A;&#x672A;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x4E8E;&#x7CFB;&#x7EDF;&#x5185;&#x90E8;&#xFF0C;&#x8868;&#x793A;&#x4E00;&#x79CD;&#x6D4B;&#x91CF;&#x72B6;&#x6001;</li>
<li><strong>EXACTLY</strong>&#xFF1A;&#x7CBE;&#x786E;&#x6A21;&#x5F0F;&#xFF0C;&#x5BF9;&#x4E8E; match_parent &#x548C;&#x5177;&#x4F53;&#x7684;&#x5BBD;&#x9AD8;&#x6570;&#x503C;</li>
<li><strong>AT_MOST</strong>&#xFF1A;&#x6700;&#x5927;&#x6A21;&#x5F0F;&#xFF0C;&#x7236;&#x5BB9;&#x5668;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x5927;&#x5C0F;&#xFF0C;View &#x7684;&#x5927;&#x5C0F;&#x4E0D;&#x80FD;&#x5927;&#x4E8E;&#x8FD9;&#x4E2A;&#x503C;&#xFF0C;&#x5177;&#x4F53;&#x503C;&#x8981;&#x770B;&#x4E0D;&#x540C; View &#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#xFF0C;&#x5BF9;&#x5E94; wrap_content</li>
</ul>
<p>&#x67E5;&#x770B;&#x6E90;&#x7801;&#x53EF;&#x77E5;&#xFF0C;&#x5B50; View &#x7684; MeasureSpec &#x53D7;&#x5230;&#x7236;&#x5BB9;&#x5668;&#x7684; MeasureSpec &#x548C;&#x81EA;&#x8EAB;&#x7684; LayoutParams &#x5F71;&#x54CD;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getChildMeasureSpec</span><span class="hljs-params">(<span class="hljs-keyword">int</span> spec, <span class="hljs-keyword">int</span> padding, <span class="hljs-keyword">int</span> childDimension)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class="line">    <span class="hljs-keyword">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">int</span> size = Math.max(<span class="hljs-number">0</span>, specSize - padding);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">int</span> resultSize = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> resultMode = <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">switch</span> (specMode) {</span><br><span class="line">    <span class="hljs-comment">// Parent has imposed an exact size on us</span></span><br><span class="line">    <span class="hljs-keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">        <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) {</span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class="line">            <span class="hljs-comment">// Child wants to be our size. So be it.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class="line">            <span class="hljs-comment">// Child wants to determine its own size. It can&apos;t be</span></span><br><span class="line">            <span class="hljs-comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Parent has imposed a maximum size on us</span></span><br><span class="line">    <span class="hljs-keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">        <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) {</span><br><span class="line">            <span class="hljs-comment">// Child wants a specific size... so be it</span></span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class="line">            <span class="hljs-comment">// Child wants to be our size, but our size is not fixed.</span></span><br><span class="line">            <span class="hljs-comment">// Constrain child to not be bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class="line">            <span class="hljs-comment">// Child wants to determine its own size. It can&apos;t be</span></span><br><span class="line">            <span class="hljs-comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Parent asked to see how big we want to be</span></span><br><span class="line">    <span class="hljs-keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">        <span class="hljs-keyword">if</span> (childDimension &gt;= <span class="hljs-number">0</span>) {</span><br><span class="line">            <span class="hljs-comment">// Child wants a specific size... let him have it</span></span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class="line">            <span class="hljs-comment">// Child wants to be our size... find out how big it should</span></span><br><span class="line">            <span class="hljs-comment">// be</span></span><br><span class="line">            resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="hljs-number">0</span> : size;</span><br><span class="line">            resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class="line">            <span class="hljs-comment">// Child wants to determine its own size.... find out how</span></span><br><span class="line">            <span class="hljs-comment">// big it should be</span></span><br><span class="line">            resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="hljs-number">0</span> : size;</span><br><span class="line">            resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-comment">//noinspection ResourceType</span></span><br><span class="line">    <span class="hljs-keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://image.kangxiaoguang.com/1525426389.png" alt></p>
<h2 id="measure"><a href="#measure" class="headerlink" title="measure"></a>measure</h2><p>&#x4E0B;&#x56FE;&#x5C31;&#x662F;&#x6839;&#x636E;&#x6E90;&#x7801;&#x7ED8;&#x5236;&#x7684; measure &#x6D41;&#x7A0B;&#xFF1A;</p>
<p><img src="https://image.kangxiaoguang.com/1525427338.png" alt></p>
<p>&#x5176;&#x5B9E;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x76F4;&#x63A5;&#x7EE7;&#x627F; View &#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7EC4;&#x4EF6;&#xFF0C;&#x5F53; MeasureSpec &#x4E3A; AT_MOST &#x65F6;&#xFF0C;&#x6B64;&#x65F6;&#x8BE5;&#x81EA;&#x5B9A;&#x4E49; View &#x7684;wrap_content &#x548C; match_parent &#x7684;&#x6548;&#x679C;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x91CD;&#x5199; <code>onMeasure</code> &#x907F;&#x514D;&#x8BE5;&#x95EE;&#x9898;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMeasure</span><span class="hljs-params">(<span class="hljs-keyword">int</span> widthMeasureSpec, <span class="hljs-keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">if</span> (MeasureSpec.AT_MOST == widthMode &amp;&amp; MeasureSpec.AT_MOST == heightMode) {</span><br><span class="line">        setMeasuredDimension(mWidth, mHeight);</span><br><span class="line">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (MeasureSpec.AT_MOST == widthMode) {</span><br><span class="line">        setMeasuredDimension(mWidth, heightSize);</span><br><span class="line">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (MeasureSpec.AT_MOST == heightMode) {</span><br><span class="line">        setMeasuredDimension(widthSize, mHeight);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="&#x6D4B;&#x91CF;&#x5BBD;&#x9AD8;"><a href="#&#x6D4B;&#x91CF;&#x5BBD;&#x9AD8;" class="headerlink" title="&#x6D4B;&#x91CF;&#x5BBD;&#x9AD8;"></a>&#x6D4B;&#x91CF;&#x5BBD;&#x9AD8;</h3><p>View &#x7684;&#x6D4B;&#x91CF;&#x5BBD;&#x9AD8;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x7CFB;&#x7EDF;&#x591A;&#x6B21;&#x8C03;&#x7528; measure &#x540E;&#x624D;&#x80FD;&#x83B7;&#x53D6;&#xFF0C;&#x4E14; measure &#x7684;&#x6267;&#x884C;&#x548C; Activity &#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E0D;&#x662F;&#x540C;&#x6B65;&#x6267;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x4FDD;&#x969C;&#x5728; Activity &#x7684;&#x67D0;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x51FD;&#x6570;&#x4E2D;&#x83B7;&#x53D6; View &#x7684;&#x51C6;&#x53BB;&#x6D4B;&#x91CF;&#x5BBD;&#x9AD8;&#xFF0C;&#x4E0B;&#x9762;&#x63D0;&#x4F9B;&#x56DB;&#x79CD;&#x83B7;&#x53D6;&#x5BBD;&#x9AD8;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;</p>
<h3 id="Activity-onWindowFocusChanged"><a href="#Activity-onWindowFocusChanged" class="headerlink" title="Activity#onWindowFocusChanged"></a>Activity#onWindowFocusChanged</h3><p>&#x5728; Activity &#x83B7;&#x53D6;&#xFF08;onResume&#xFF09;&#x6216;&#x5931;&#x53BB;&#x7126;&#x70B9;&#xFF08;onPause&#xFF09;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#xFF0C;&#x6B64;&#x65F6; Activity &#x4E2D;&#x7684; View &#x5DF2;&#x7ECF;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x653E;&#x5FC3;&#x5927;&#x80C6;&#x7684;&#x83B7;&#x53D6;&#x5176;&#x5BBD;&#x9AD8;&#x4E86;</p>
<h3 id="View-post-Runnable"><a href="#View-post-Runnable" class="headerlink" title="View.post(Runnable)"></a>View.post(Runnable)</h3><p>&#x653E;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5230;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5F53;&#x6267;&#x884C;&#x5230;&#x8BE5;&#x6D88;&#x606F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6B64;&#x65F6; View &#x5DF2;&#x7ECF;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;</p>
<h3 id="ViewTreeObserver-onGlobalLayout"><a href="#ViewTreeObserver-onGlobalLayout" class="headerlink" title="ViewTreeObserver#onGlobalLayout"></a>ViewTreeObserver#onGlobalLayout</h3><p>&#x4F7F;&#x7528; ViewTreeObserver&#xFF0C;&#x5F53; View &#x72B6;&#x6001;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x8C03;&#x7528; onGlobalLayout &#x51FD;&#x6570;&#xFF0C;&#x7531;&#x4E8E; View &#x7684;&#x72B6;&#x6001;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x591A;&#x6B21;&#xFF0C;&#x6240;&#x4EE5; onGlobalLayout &#x4E5F;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x591A;&#x6B21;</p>
<h3 id="&#x624B;&#x52A8;-measure"><a href="#&#x624B;&#x52A8;-measure" class="headerlink" title="&#x624B;&#x52A8; measure"></a>&#x624B;&#x52A8; measure</h3><p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x80FD;&#x4F7F;&#x7528;&#xFF1A;</p>
<ul>
<li><p>match_parent&#xFF1A;&#x76F4;&#x63A5;&#x653E;&#x5F03;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x7684; measureSpec&#xFF0C;&#x9700;&#x8981;&#x77E5;&#x9053;&#x7236;&#x5BB9;&#x5668;&#x5269;&#x4F59;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#xFF0C;&#x6B64;&#x65F6;&#x5E76;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x7236;&#x5BB9;&#x5668;&#x5269;&#x4F59;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;</p>
</li>
<li><p>warp_content&#xFF1A;</p>
<p>  </p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// View &#x7684;&#x5C3A;&#x5BF8;&#x7528;30&#x4F4D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x8868;&#x793A;&#xFF0C;&#x6700;&#x5927;&#x5316;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x4F7F;&#x7528; View &#x7684;&#x6700;&#x5927;&#x503C; (1 &lt;&lt; 30) - 1 &#x6784;&#x5EFA; measureSpec</span></span><br><span class="line"><span class="hljs-keyword">int</span> width = View.MeasureSpec.makeMeasureSpec((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>) - <span class="hljs-number">1</span>, View.MeasureSpec.AT_MOST);</span><br><span class="line"><span class="hljs-keyword">int</span> height = View.MeasureSpec.makeMeasureSpec((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>) - <span class="hljs-number">1</span>, View.MeasureSpec.AT_MOST);</span><br><span class="line">mView.measure(width, height);</span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>&#x5177;&#x4F53;&#x6570;&#x503C;&#xFF1A;</p>
<p>  </p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 100 &#x4E3A;&#x5177;&#x4F53;&#x6570;&#x503C;</span></span><br><span class="line"><span class="hljs-keyword">int</span> width = View.MeasureSpec.makeMeasureSpec(<span class="hljs-number">100</span>, View.MeasureSpec.EXACTLY);</span><br><span class="line"><span class="hljs-keyword">int</span> height = View.MeasureSpec.makeMeasureSpec(<span class="hljs-number">100</span>,View.MeasureSpec.EXACTLY);</span><br><span class="line">mView.measure(width, height);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h2><p>&#x76F8;&#x5BF9;&#x4E8E; measure&#xFF0C;layout &#x6D41;&#x7A0B;&#x5C31;&#x7B80;&#x5355;&#x591A;&#x4E86;&#xFF0C;&#x9996;&#x5148;&#x4F7F;&#x7528; <code>setFrame</code> &#x6765;&#x8BBE;&#x7F6E; View &#x56DB;&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x9876;&#x70B9;&#x4E00;&#x65E6;&#x786E;&#x5B9A;&#xFF0C;View &#x7684;&#x4F4D;&#x7F6E;&#x4E5F;&#x5C31;&#x786E;&#x5B9A;&#x4E86;&#x3002;&#x63A5;&#x7740;&#x5C31;&#x4F1A;&#x8C03;&#x7528; <code>onLayout</code> &#x786E;&#x5B9A;&#x5B50; View &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x548C; <code>onMeasure</code> &#x7C7B;&#x4F3C;&#xFF0C;onLayout &#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x548C;&#x5177;&#x4F53;&#x7684; View &#x6709;&#x5173;</p>
</li>
</ul>
<h2 id="draw"><a href="#draw" class="headerlink" title="draw"></a>draw</h2><p>&#x901A;&#x8FC7; <code>View#draw</code> &#x7684;&#x6E90;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x6E05;&#x6670;&#x7684;&#x770B;&#x51FA;&#x6765; <code>draw</code> &#x7684;&#x7ED8;&#x5236;&#x6D41;&#x7A0B;&#xFF1A;</p>
<ul>
<li>drawBackground&#xFF1A;&#x7ED8;&#x5236;&#x80CC;&#x666F;</li>
<li>onDraw&#xFF1A;&#x7ED8;&#x5236;&#x5185;&#x5BB9;</li>
<li>dispatchDraw&#xFF1A;&#x7ED8;&#x5236;&#x5B50; View</li>
<li>onDrawForeground&#xFF1A;&#x7ED8;&#x5236;&#x524D;&#x666F;&#xFF0C;&#x5305;&#x62EC; <code>onDrawScrollIndicators</code>&#x3001;<code>onDrawScrollBars</code></li>
</ul>
<p><code>View#setWillNotDraw</code> &#x51FD;&#x6570;&#x8868;&#x793A;&#x5982;&#x679C;&#x4E00;&#x4E2A; View &#x81EA;&#x8EAB;&#x4E0D;&#x5904;&#x7406; <code>onDraw</code>&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;&#x6807;&#x8BC6;&#x4E3A; true&#xFF0C;&#x7CFB;&#x7EDF;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x6807;&#x8BC6;&#x4E3A; true&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x4F18;&#x5316;&#x3002;View &#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5F00;&#x542F;&#xFF0C;ViewGroup &#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#x3002;&#x5728;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x81EA;&#x5B9A;&#x4E49;&#x7684; ViewGroup &#x5E76;&#x6CA1;&#x6709;&#x5904;&#x7406; <code>onDraw</code> &#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x542F;&#x8FD9;&#x4E2A;&#x6807;&#x8BC6;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x9700;&#x8981;&#x663E;&#x793A;&#x7684;&#x5173;&#x95ED;&#x8BE5;&#x6807;&#x8BC6;</p>
<h2 id="LinearLayout-&#x548C;-RelativeLayout-&#x6027;&#x80FD;&#x5BF9;&#x6BD4;"><a href="#LinearLayout-&#x548C;-RelativeLayout-&#x6027;&#x80FD;&#x5BF9;&#x6BD4;" class="headerlink" title="LinearLayout &#x548C; RelativeLayout &#x6027;&#x80FD;&#x5BF9;&#x6BD4;"></a>LinearLayout &#x548C; RelativeLayout &#x6027;&#x80FD;&#x5BF9;&#x6BD4;</h2><p>&#x9996;&#x5148;&#x770B;&#x4E00;&#x4E0B; <code>LinearLayout#onMeasure</code>&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMeasure</span><span class="hljs-params">(<span class="hljs-keyword">int</span> widthMeasureSpec, <span class="hljs-keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (mOrientation == VERTICAL) {</span><br><span class="line">        measureVertical(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        measureHorizontal(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    View[] views = mSortedHorizontalChildren;</span><br><span class="line">        <span class="hljs-keyword">int</span> count = views.length;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</span><br><span class="line">            View child = views[i];</span><br><span class="line">            <span class="hljs-keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                LayoutParams params = (LayoutParams) child.getLayoutParams();</span><br><span class="line">                <span class="hljs-keyword">int</span>[] rules = params.getRules(layoutDirection);</span><br><span class="line"></span><br><span class="line">                applyHorizontalSizeRules(params, myWidth, rules);</span><br><span class="line">                measureChildHorizontal(child, params, myWidth, myHeight);</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (positionChildHorizontal(child, params, myWidth, isWrapContentWidth)) {</span><br><span class="line">                    offsetHorizontalAxis = <span class="hljs-keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        views = mSortedVerticalChildren;</span><br><span class="line">        count = views.length;</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> targetSdkVersion = getContext().getApplicationInfo().targetSdkVersion;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</span><br><span class="line">            <span class="hljs-keyword">final</span> View child = views[i];</span><br><span class="line">            <span class="hljs-keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                <span class="hljs-keyword">final</span> LayoutParams params = (LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">                applyVerticalSizeRules(params, myHeight, child.getBaseline());</span><br><span class="line">                measureChild(child, params, myWidth, myHeight);</span><br><span class="line">                <span class="hljs-keyword">if</span> (positionChildVertical(child, params, myHeight, isWrapContentHeight)) {</span><br><span class="line">                    offsetVerticalAxis = <span class="hljs-keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (isWrapContentWidth) {</span><br><span class="line">                    <span class="hljs-keyword">if</span> (isLayoutRtl()) {</span><br><span class="line">                        <span class="hljs-keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.KITKAT) {</span><br><span class="line">                            width = Math.max(width, myWidth - params.mLeft);</span><br><span class="line">                        } <span class="hljs-keyword">else</span> {</span><br><span class="line">                            width = Math.max(width, myWidth - params.mLeft + params.leftMargin);</span><br><span class="line">                        }</span><br><span class="line">                    } <span class="hljs-keyword">else</span> {</span><br><span class="line">                        <span class="hljs-keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.KITKAT) {</span><br><span class="line">                            width = Math.max(width, params.mRight);</span><br><span class="line">                        } <span class="hljs-keyword">else</span> {</span><br><span class="line">                            width = Math.max(width, params.mRight + params.rightMargin);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (isWrapContentHeight) {</span><br><span class="line">                    <span class="hljs-keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.KITKAT) {</span><br><span class="line">                        height = Math.max(height, params.mBottom);</span><br><span class="line">                    } <span class="hljs-keyword">else</span> {</span><br><span class="line">                        height = Math.max(height, params.mBottom + params.bottomMargin);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (child != ignore || verticalGravity) {</span><br><span class="line">                    left = Math.min(left, params.mLeft - params.leftMargin);</span><br><span class="line">                    top = Math.min(top, params.mTop - params.topMargin);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (child != ignore || horizontalGravity) {</span><br><span class="line">                    right = Math.max(right, params.mRight + params.rightMargin);</span><br><span class="line">                    bottom = Math.max(bottom, params.mBottom + params.bottomMargin);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x518D;&#x6765;&#x770B;&#x4E00;&#x4E0B; <code>RelativeLayout#onMeasure</code>&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMeasure</span><span class="hljs-params">(<span class="hljs-keyword">int</span> widthMeasureSpec, <span class="hljs-keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">...</span><br><span class="line">    View[] views = mSortedHorizontalChildren;</span><br><span class="line">        <span class="hljs-keyword">int</span> count = views.length;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</span><br><span class="line">            View child = views[i];</span><br><span class="line">            <span class="hljs-keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                LayoutParams params = (LayoutParams) child.getLayoutParams();</span><br><span class="line">                <span class="hljs-keyword">int</span>[] rules = params.getRules(layoutDirection);</span><br><span class="line"></span><br><span class="line">                applyHorizontalSizeRules(params, myWidth, rules);</span><br><span class="line">                measureChildHorizontal(child, params, myWidth, myHeight);</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (positionChildHorizontal(child, params, myWidth, isWrapContentWidth)) {</span><br><span class="line">                    offsetHorizontalAxis = <span class="hljs-keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        views = mSortedVerticalChildren;</span><br><span class="line">        count = views.length;</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> targetSdkVersion = getContext().getApplicationInfo().targetSdkVersion;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</span><br><span class="line">            <span class="hljs-keyword">final</span> View child = views[i];</span><br><span class="line">            <span class="hljs-keyword">if</span> (child.getVisibility() != GONE) {</span><br><span class="line">                <span class="hljs-keyword">final</span> LayoutParams params = (LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">                applyVerticalSizeRules(params, myHeight, child.getBaseline());</span><br><span class="line">                measureChild(child, params, myWidth, myHeight);</span><br><span class="line">                <span class="hljs-keyword">if</span> (positionChildVertical(child, params, myHeight, isWrapContentHeight)) {</span><br><span class="line">                    offsetVerticalAxis = <span class="hljs-keyword">true</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (isWrapContentWidth) {</span><br><span class="line">                    <span class="hljs-keyword">if</span> (isLayoutRtl()) {</span><br><span class="line">                        <span class="hljs-keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.KITKAT) {</span><br><span class="line">                            width = Math.max(width, myWidth - params.mLeft);</span><br><span class="line">                        } <span class="hljs-keyword">else</span> {</span><br><span class="line">                            width = Math.max(width, myWidth - params.mLeft + params.leftMargin);</span><br><span class="line">                        }</span><br><span class="line">                    } <span class="hljs-keyword">else</span> {</span><br><span class="line">                        <span class="hljs-keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.KITKAT) {</span><br><span class="line">                            width = Math.max(width, params.mRight);</span><br><span class="line">                        } <span class="hljs-keyword">else</span> {</span><br><span class="line">                            width = Math.max(width, params.mRight + params.rightMargin);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (isWrapContentHeight) {</span><br><span class="line">                    <span class="hljs-keyword">if</span> (targetSdkVersion &lt; Build.VERSION_CODES.KITKAT) {</span><br><span class="line">                        height = Math.max(height, params.mBottom);</span><br><span class="line">                    } <span class="hljs-keyword">else</span> {</span><br><span class="line">                        height = Math.max(height, params.mBottom + params.bottomMargin);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (child != ignore || verticalGravity) {</span><br><span class="line">                    left = Math.min(left, params.mLeft - params.leftMargin);</span><br><span class="line">                    top = Math.min(top, params.mTop - params.topMargin);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> (child != ignore || horizontalGravity) {</span><br><span class="line">                    right = Math.max(right, params.mRight + params.rightMargin);</span><br><span class="line">                    bottom = Math.max(bottom, params.mBottom + params.bottomMargin);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> useExcessSpace = lp.height == <span class="hljs-number">0</span> &amp;&amp; lp.weight &gt; <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (heightMode == MeasureSpec.EXACTLY &amp;&amp; useExcessSpace) {</span><br><span class="line">        <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x8BBE;&#x7F6E;&#x4E86; weight &#x4E14; height &#x662F;0&#x7684;&#x65F6;&#x5019;&#x5C31;&#x8DF3;&#x8FC7;&#x6D4B;&#x7ED8;&#xFF0C;&#x53EA;&#x628A; margin &#x503C;&#x6DFB;&#x52A0;&#x5230;&#x603B;&#x9AD8;&#x4E2D;</span></span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> totalLength = mTotalLength;</span><br><span class="line">        mTotalLength = Math.max(totalLength, totalLength + lp.topMargin + lp.bottomMargin);</span><br><span class="line">        skippedMeasure = <span class="hljs-keyword">true</span>;</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-keyword">if</span> (useExcessSpace) {</span><br><span class="line">            lp.height = LayoutParams.WRAP_CONTENT;</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> usedHeight = totalWeight == <span class="hljs-number">0</span> ? mTotalLength : <span class="hljs-number">0</span>;</span><br><span class="line">        measureChildBeforeLayout(child, i, widthMeasureSpec, <span class="hljs-number">0</span>,</span><br><span class="line">                heightMeasureSpec, usedHeight);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> childHeight = child.getMeasuredHeight();</span><br><span class="line">        <span class="hljs-keyword">if</span> (useExcessSpace) {</span><br><span class="line">            lp.height = <span class="hljs-number">0</span>;</span><br><span class="line">            consumedExcessSpace += childHeight;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> totalLength = mTotalLength;</span><br><span class="line">        mTotalLength = Math.max(totalLength, totalLength + childHeight + lp.topMargin +</span><br><span class="line">               lp.bottomMargin + getNextLocationOffset(child));</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (useLargestChild) {</span><br><span class="line">            largestChildHeight = Math.max(childHeight, largestChildHeight);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x53EF;&#x4EE5;&#x5F88;&#x660E;&#x663E;&#x7684;&#x770B;&#x51FA;&#x6765; <code>RelativeLayout</code> &#x8FDB;&#x884C;&#x4E86;&#x4E24;&#x6B21; <code>onMeasure</code>&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A; <code>RelativeLayout</code> &#x4E2D;&#x7684;&#x5B50; View &#x4E4B;&#x95F4;&#x6709;&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x9700;&#x8981;&#x5148;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x6A2A;&#x5411;&#x6D4B;&#x91CF;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x7EB5;&#x5411;&#x6D4B;&#x91CF;&#x624D;&#x80FD;&#x786E;&#x5B9A;&#x5B50; View &#x7684;&#x4F4D;&#x7F6E;</p>
<p>&#x800C; <code>LinearLayout</code> &#x53EA;&#x6D4B;&#x91CF;&#x4E86;&#x4E00;&#x6B21;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86; <code>weight</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x8DF3;&#x8FC7;&#x6D4B;&#x91CF;&#x8FD9;&#x4E2A; View&#xFF0C;&#x7B49;&#x5269;&#x4F59;&#x6240;&#x6709;&#x7684; View &#x90FD;&#x6D4B;&#x91CF;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x628A;&#x5269;&#x4F59;&#x7A7A;&#x95F4;&#x6309;&#x7167; <code>weight</code> &#x7684;&#x503C;&#x5206;&#x914D;&#x7ED9;&#x5BF9;&#x5E94;&#x7684; View&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x8BE5; View &#x4F1A;&#x6D4B;&#x91CF;&#x4E00;&#x6B21;&#x3002;&#x7531;&#x6B64;&#x53EF;&#x89C1; <code>weight</code> &#x5BF9;&#x6027;&#x80FD;&#x8FD8;&#x662F;&#x6709;&#x5F71;&#x54CD;&#x7684;</p>
<p>&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E3A;&#x4E86;&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5D4C;&#x5957;&#x548C;&#x5C42;&#x7EA7;&#x6DF1;&#x5EA6;&#xFF0C;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>RelativeLayout</code>&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528; <code>LinearLayout</code> &#x5E03;&#x5C40;&#x5F88;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x592A;&#x591A;&#x5E03;&#x5C40;&#x5D4C;&#x5957;&#xFF0C;&#x5728;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#x4E0D;&#x6DF1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8FD8;&#x662F;&#x8981;&#x4F18;&#x5148;&#x4F7F;&#x7528; <code>LinearLayout</code></p>
<h2 id="&#x81EA;&#x5B9A;&#x4E49;-View"><a href="#&#x81EA;&#x5B9A;&#x4E49;-View" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49; View"></a>&#x81EA;&#x5B9A;&#x4E49; View</h2><h3 id="&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"><a href="#&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;" class="headerlink" title="&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"></a>&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</h3><ul>
<li>&#x7EE7;&#x627F; View &#x91CD;&#x5199; onDraw &#x51FD;&#x6570;</li>
<li>&#x7EE7;&#x627F; ViewGroup &#x81EA;&#x5B9A;&#x4E49;&#x7279;&#x6B8A;&#x7684; Layout</li>
<li>&#x7EE7;&#x627F;&#x73B0;&#x6709;&#x7684; View &#x5B50;&#x7C7B;&#xFF08;&#x4F8B;&#x5982; Button&#xFF09;</li>
<li>&#x7EE7;&#x627F;&#x73B0;&#x6709;&#x7684; ViewGroup &#x5B50;&#x7C7B;&#xFF08;&#x4F8B;&#x5982; LinearLayout&#xFF09;</li>
</ul>
<h3 id="&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a href="#&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h3><ul>
<li>&#x5C3D;&#x91CF;&#x8BA9;&#x81EA;&#x5B9A;&#x4E49; View &#x652F;&#x6301; wrap_content</li>
<li>&#x5C3D;&#x91CF;&#x8BA9;&#x81EA;&#x5B9A;&#x4E49; View &#x652F;&#x6301; padding &#x548C; margin &#x5C5E;&#x6027;</li>
<li>&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x5728;&#x81EA;&#x5B9A;&#x4E49; View &#x5185;&#x90E8;&#x4F7F;&#x7528; Handler&#xFF0C;&#x56E0;&#x4E3A; View &#x81EA;&#x8EAB;&#x5C31;&#x63D0;&#x4F9B;&#x6709; post </li>
<li>&#x5982;&#x679C;&#x6709;&#x6ED1;&#x52A8;&#xFF0C;&#x8003;&#x8651;&#x5230;&#x6ED1;&#x52A8;&#x51B2;&#x7A81;&#x7684;&#x60C5;&#x51B5;</li>
<li>&#x5982;&#x679C; View &#x4E2D;&#x6709;&#x7EBF;&#x7A0B;&#x6216;&#x8005;&#x52A8;&#x753B;&#xFF0C;&#x9700;&#x8981;&#x53CA;&#x65F6;&#x505C;&#x6B62;&#x3002;&#x5F53; View &#x6240;&#x4F9D;&#x8D56;&#x7684; Activity &#x9500;&#x6BC1;&#x6216;&#x8005;&#x8BE5; View &#x88AB;  Remove &#x65F6;&#xFF0C;<code>View#onDatachedFromWindow</code> &#x4F1A;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x6B64;&#x65F6;&#x5E94;&#x5F53;&#x505C;&#x6B62; View &#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x548C;&#x52A8;&#x753B;&#xFF1B;&#x4E0E;&#x8BE5;&#x51FD;&#x6570;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x662F; <code>View#onAttachedToWindow</code>&#xFF0C;&#x5F53; View &#x6240;&#x5728;&#x7684; Activity &#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;</li>
</ul>
<h3 id="&#x7EE7;&#x627F;-View"><a href="#&#x7EE7;&#x627F;-View" class="headerlink" title="&#x7EE7;&#x627F; View"></a>&#x7EE7;&#x627F; View</h3><p>&#x9996;&#x5148;&#x9700;&#x8981;&#x91CD;&#x5199; View &#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x4F1A;&#x89E6;&#x53D1;&#x4E0D;&#x540C;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">View</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * &#x4ECE;&#x4EE3;&#x7801;&#x521B;&#x5EFA; View &#x65F6;&#x8C03;&#x7528;&#x8BE5;&#x6784;&#x9020;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomView</span><span class="hljs-params">(Context context)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">this</span>(context, <span class="hljs-keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * &#x5728; XML &#x4E2D;&#x5F15;&#x7528;&#x8BE5; View &#x65F6;&#x8C03;&#x7528;&#x8BE5;&#x6784;&#x9020;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomView</span><span class="hljs-params">(Context context, @Nullable AttributeSet attrs)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">this</span>(context, attrs, <span class="hljs-number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * &#x5728; XML &#x4E2D;&#x5F15;&#x7528;&#x8BE5; View&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x4E00;&#x4E2A; style &#x6837;&#x5F0F;</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomView</span><span class="hljs-params">(Context context, @Nullable AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x63A5;&#x7740;&#x9700;&#x8981;&#x91CD;&#x5199; <code>onDraw()</code> &#x51FD;&#x6570;&#x753B;&#x4E00;&#x4E2A;&#x5706;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(Canvas canvas)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>.onDraw(canvas);</span><br><span class="line">    <span class="hljs-keyword">int</span> width = getWidth();</span><br><span class="line">    <span class="hljs-keyword">int</span> height = getHeight();</span><br><span class="line">    <span class="hljs-keyword">int</span> radius = Math.min(width, height) / <span class="hljs-number">2</span>;</span><br><span class="line">    <span class="hljs-comment">// &#x4E00;&#x53C2;&#x662F;&#x5706;&#x5FC3;&#x7684; X &#x8F74;&#x5750;&#x6807;&#xFF0C;&#x4E8C;&#x53C2;&#x662F;&#x5706;&#x5FC3; Y &#x8F74;&#x5750;&#x6807;&#xFF0C;&#x4E09;&#x53C2;&#x662F;&#x5706;&#x534A;&#x5F84;&#xFF0C;&#x56DB;&#x53C2;&#x662F;&#x7528;&#x6765;&#x753B;&#x5706;&#x7684;&#x753B;&#x7B14;</span></span><br><span class="line">    canvas.drawCircle(width / <span class="hljs-number">2</span>, height / <span class="hljs-number">2</span>, radius, mPaint);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x8FD8;&#x9700;&#x8981;&#x8003;&#x8651;&#x8BBE;&#x7F6E;&#x4E86; <code>padding</code> &#x4EE5;&#x53CA; <code>warp_content</code> &#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x91CD;&#x5199; <code>onMeasure()</code> &#x548C; <code>onDraw()</code> &#x51FD;&#x6570;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// warp_content &#x9700;&#x8981;&#x91CD;&#x5199; onMeasure()</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMeasure</span><span class="hljs-params">(<span class="hljs-keyword">int</span> widthMeasureSpec, <span class="hljs-keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">    <span class="hljs-keyword">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">    <span class="hljs-comment">// mWidth mHeight &#x4E3A;&#x9ED8;&#x8BA4;&#x503C;</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (MeasureSpec.AT_MOST == widthMode &amp;&amp; MeasureSpec.AT_MOST == heightMode) {</span><br><span class="line">        setMeasuredDimension(mWidth, mHeight);</span><br><span class="line">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (MeasureSpec.AT_MOST == widthMode) {</span><br><span class="line">        setMeasuredDimension(mWidth, heightSize);</span><br><span class="line">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (MeasureSpec.AT_MOST == heightMode) {</span><br><span class="line">        setMeasuredDimension(widthSize, mHeight);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// padding &#x9700;&#x8981;&#x91CD;&#x5199; onDraw()&#xFF0C;&#x5728;&#x7ED8;&#x5236;&#x7684;&#x65F6;&#x5019;&#x628A; padding &#x53BB;&#x6389;&#x5373;&#x53EF;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(Canvas canvas)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>.onDraw(canvas);</span><br><span class="line">    <span class="hljs-keyword">int</span> paddingTop = getPaddingTop();</span><br><span class="line">    <span class="hljs-keyword">int</span> paddingBottom = getPaddingBottom();</span><br><span class="line">    <span class="hljs-keyword">int</span> paddingLeft = getPaddingLeft();</span><br><span class="line">    <span class="hljs-keyword">int</span> paddingRight = getPaddingRight();</span><br><span class="line">    <span class="hljs-keyword">int</span> width = getWidth() - paddingLeft - paddingRight;</span><br><span class="line">    <span class="hljs-keyword">int</span> height = getHeight() - paddingTop - paddingBottom;</span><br><span class="line">    <span class="hljs-keyword">int</span> radius = Math.min(width, height) / <span class="hljs-number">2</span>;</span><br><span class="line">    <span class="hljs-comment">// &#x4E00;&#x53C2;&#x662F;&#x5706;&#x5FC3;&#x7684; X &#x8F74;&#x5750;&#x6807;&#xFF0C;&#x4E8C;&#x53C2;&#x662F;&#x5706;&#x5FC3; Y &#x8F74;&#x5750;&#x6807;&#xFF0C;&#x4E09;&#x53C2;&#x662F;&#x5706;&#x534A;&#x5F84;&#xFF0C;&#x56DB;&#x53C2;&#x662F;&#x7528;&#x6765;&#x753B;&#x5706;&#x7684;&#x753B;&#x7B14;</span></span><br><span class="line">    canvas.drawCircle(paddingLeft + width / <span class="hljs-number">2</span>,paddingTop + height / <span class="hljs-number">2</span>, radius, mPaint);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x4E5F;&#x8BB8;&#x8FD8;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E00;&#x4E9B;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6837;&#x5F0F;&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x5728; <code>values</code> &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>attrs.xml</code> &#x6587;&#x4EF6;&#xFF08;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x6587;&#x4EF6;&#x540D;&#xFF09;&#x5B58;&#x653E;&#x58F0;&#x660E;&#x7684;&#x6837;&#x5F0F;&#xFF0C;&#x4E0B;&#x9762;&#x662F; <code>attrs_circle_view.xml</code>&#xFF1A;</p>
<p></p><figure class="highlight xml hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span></span><br><span class="line">	<span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CustomView&quot;</span>&gt;</span></span><br><span class="line">		<span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;circle_color&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;color&quot;</span>/&gt;</span></span><br><span class="line">	<span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5728; xml &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5F15;&#x7528;&#x9700;&#x8981;&#x58F0;&#x660E;&#x4E00;&#x4E2A; schemas &#x58F0;&#x660E;&#xFF1A;<code>xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</code> &#xFF1A;</p>
<p></p><figure class="highlight xml hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">tools:context</span>=<span class="hljs-string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-tag">&lt;<span class="hljs-name">org.lovedev.chapter_4.CustomView</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/view&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:padding</span>=<span class="hljs-string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">app:circle_color</span>=<span class="hljs-string">&quot;@color/colorPrimary&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;100dp&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5728;&#x81EA;&#x5B9A;&#x4E49; View &#x4E2D;&#x9700;&#x8981;&#x5F15;&#x7528;&#x5E76;&#x89E3;&#x6790;&#x8FD9;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6837;&#x5F0F;&#x5C5E;&#x6027;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomView</span><span class="hljs-params">(Context context, @Nullable AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.CustomView);</span><br><span class="line">    <span class="hljs-comment">// mColor &#x5C31;&#x662F;&#x901A;&#x8FC7; app:circle_color &#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x7684;&#x989C;&#x8272;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x5C31;&#x9ED8;&#x8BA4;&#x662F; Color.RED</span></span><br><span class="line">    mColor = typedArray.getColor(R.styleable.CustomView_circle_color, Color.RED);</span><br><span class="line">    typedArray.recycle();</span><br><span class="line">    init();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">    mPaint = <span class="hljs-keyword">new</span> Paint();</span><br><span class="line">    mPaint.setColor(mColor);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="&#x5E03;&#x5C40;&#x4F18;&#x5316;"><a href="#&#x5E03;&#x5C40;&#x4F18;&#x5316;" class="headerlink" title="&#x5E03;&#x5C40;&#x4F18;&#x5316;"></a>&#x5E03;&#x5C40;&#x4F18;&#x5316;</h2><p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Android Device Monitor</code> &#x4EE5;&#x53CA; <code>layout inspector</code> &#x5DE5;&#x5177;&#x67E5;&#x770B;&#x9875;&#x9762;&#x5E03;&#x5C40;&#xFF0C;&#x4E0D;&#x8FC7; <code>Android Device Monitor</code> &#x5DF2;&#x7ECF;&#x4ECE; Andorid Studio &#x4E2D;&#x5E9F;&#x5F03;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href="https://developer.android.com/studio/profile/monitor#usage" target="_blank" rel="noopener">&#x5B98;&#x65B9;&#x89E3;&#x91CA;</a></p>
<h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><p>&#x8BE5;&#x6807;&#x7B7E;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x91CD;&#x7528;&#x5E03;&#x5C40;&#xFF0C;&#x6BD4;&#x5982;&#x591A;&#x4E2A;&#x9875;&#x9762;&#x76F8;&#x540C;&#x7684;&#x5934;&#x5E03;&#x5C40;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x9664;&#x4E86;&#x4F4D;&#x7F6E;&#x548C;&#x5E03;&#x5C40;&#x5927;&#x5C0F;&#x4EE5;&#x5916;&#xFF0C;&#x4E0D;&#x80FD;&#x505A;&#x4EFB;&#x4F55;&#x6539;&#x53D8;</p>
<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><p><code>setContentView()</code> &#x65F6;&#x4F1A;&#x8C03;&#x7528; <code>Window#setContentView()</code>&#xFF0C;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BF4;&#x8FC7; <code>PhoneWindow</code> &#x662F; <code>Window</code> &#x7684;&#x552F;&#x4E00;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x5728; <code>PhoneWindow</code> &#x4E2D;&#x80FD;&#x770B;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// This is the top-level view of the window, containing the window decor.</span></span><br><span class="line"><span class="hljs-keyword">private</span> DecorView mDecor;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0; <code>DecorView</code> &#x662F; <code>PhoneWindow</code> &#x7684;&#x6839; View&#xFF0C;&#x800C; <code>DecorView</code> &#x7EE7;&#x627F;&#x4E86; <code>FrameLayout</code>&#xFF0C;&#x5230;&#x6B64;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x5E03;&#x5C40;&#x7684;&#x6700;&#x5916;&#x5C42;&#x662F; <code>FrameLayout</code> &#x4E86;</p>
<p>&#x5148;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E; include &#x5230;&#x5E03;&#x5C40;&#x5F53;&#x4E2D;&#xFF1A;</p>
<p></p><figure class="highlight xml hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!--button.xml--&gt;</span></span><br><span class="line"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="hljs-tag">			  <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="hljs-tag">			  <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">			  <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;Merge&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;60dp&quot;</span>/&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">&lt;!--button_merge.xml--&gt;</span></span><br><span class="line"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">merge</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="hljs-tag">			  <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="hljs-tag">			  <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">			  <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;With Merge&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;60dp&quot;</span>/&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">merge</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">&lt;!--activity.xml--&gt;</span></span><br><span class="line"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="hljs-tag">	<span class="hljs-attr">tools:context</span>=<span class="hljs-string">&quot;.SecondActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-tag">&lt;<span class="hljs-name">include</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">layout</span>=<span class="hljs-string">&quot;@layout/button&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-tag">&lt;<span class="hljs-name">include</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">layout</span>=<span class="hljs-string">&quot;@layout/button_merge&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="hljs-tag">		<span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x4F7F;&#x7528; Andorid Studio &#x81EA;&#x5E26;&#x7684; Layout inspector &#x67E5;&#x770B; View Tree&#xFF1A;</p>
<p><img src="https://image.kangxiaoguang.com/1527066884.png" alt></p>
<p>&#x4ECE; View Tree &#x4E2D;&#x53EF;&#x4EE5;&#x5F88;&#x6E05;&#x6670;&#x7684;&#x770B;&#x51FA;&#xFF0C;&#x7528;&#x4E86; <code>merge</code> &#x6807;&#x7B7E;&#x7684;&#x5E03;&#x5C40;&#x81EA;&#x52A8;&#x628A;&#x5E03;&#x5C40;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x63D2;&#x5165;&#x5230;&#x4E86; <code>include</code> &#x5F15;&#x7528;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x4F7F;&#x7528; <code>merge</code> &#x6807;&#x7B7E;&#x7684;&#x90A3;&#x4E2A;&#x5E03;&#x5C40;&#x8FD8;&#x4F1A;&#x6709;&#x4E00;&#x5C42; <code>LinearLayout</code> &#x5E03;&#x5C40;</p>
<h3 id="ViewStub"><a href="#ViewStub" class="headerlink" title="ViewStub"></a>ViewStub</h3><p>&#x9996;&#x5148;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F; <code>ViewStub</code> &#x4E0D;&#x80FD;&#x5E94;&#x7528;&#x542B;&#x6709; <code>merge</code> &#x6807;&#x7B7E;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF1A;</p>
<blockquote>
<p>android.view.InflateException: <merge> can be used only with a valid ViewGroup root and attachToRoot=true</merge></p>
</blockquote>
<p><code>ViewStub</code> &#x5E38;&#x7528;&#x7684;&#x573A;&#x666F;&#x662F;&#x5F15;&#x7528;&#x90A3;&#x4E9B;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x5E03;&#x5C40;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x6CE8;&#x518C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5FC5;&#x9009;&#x9879;&#x548C;&#x4E00;&#x4E9B;&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x4E9B;&#x53EF;&#x9009;&#x9879;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x624B;&#x52A8;&#x70B9;&#x51FB;&#x67D0;&#x4E2A;&#x6309;&#x94AE;&#x624D;&#x80FD;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x59CB;&#x7528; <code>GONE</code> &#x6216;&#x8005; <code>INVISIBLE</code>&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7528; <code>VISIBLE</code> &#x663E;&#x793A;&#x4E5F;&#x80FD;&#x5B9E;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x662F;&#x7528;&#x8FD9;&#x79CD;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x5E03;&#x5C40;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x628A;&#x6240;&#x6709;&#x7684;&#x5143;&#x7D20;&#x52A0;&#x8F7D;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4F7F;&#x7528; <code>ViewStub</code> &#x5C31;&#x80FD;&#x4F18;&#x5316;&#x8FD9;&#x70B9;</p>
<p>&#x770B;&#x4E00;&#x4E0B;&#x5B98;&#x7F51;&#x5BF9;&#x4E8E; <code>ViewStub</code> &#x7684;&#x4ECB;&#x7ECD;&#xFF1A;</p>
<blockquote>
<p>A ViewStub is an invisible, zero-sized View that can be used to lazily inflate layout resources at runtime. When a ViewStub is made visible, or when inflate() is invoked, the layout resource is inflated. </p>
</blockquote>
<blockquote>
<p>&#x7B80;&#x5355;&#x7FFB;&#x8BD1;&#xFF1A;ViewStub &#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x61D2;&#x52A0;&#x8F7D;&#x5E03;&#x5C40;&#x4E14;&#x662F;&#x65E0;&#x5F62;&#x7684;&#xFF0C;0&#x5927;&#x5C0F;&#x7684; View&#xFF0C;&#x5F53; ViewStub &#x662F;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x6216;&#x8005; <code>inflate()</code> &#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x5E03;&#x5C40;&#x5C31;&#x4F1A;&#x52A0;&#x8F7D;&#x51FA;&#x6765;&#x3002;</p>
</blockquote>
<p>&#x6240;&#x4EE5;&#x5F53;&#x4F7F;&#x7528; <code>ViewStub</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>ViewStub.setVisibility(View.VISIBLE)</code> &#x6216;&#x8005; <code>ViewStub.inflate()</code> &#x5C31;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x5F15;&#x7528;&#x7684;&#x5E03;&#x5C40;&#x3002;</p>
<h2 id="RecyclerView-amp-ListView"><a href="#RecyclerView-amp-ListView" class="headerlink" title="RecyclerView &amp; ListView"></a>RecyclerView &amp; ListView</h2><h3 id="ListView-&#x7F13;&#x5B58;&#x5206;&#x6790;"><a href="#ListView-&#x7F13;&#x5B58;&#x5206;&#x6790;" class="headerlink" title="ListView &#x7F13;&#x5B58;&#x5206;&#x6790;"></a>ListView &#x7F13;&#x5B58;&#x5206;&#x6790;</h3><p>&#x67E5;&#x770B;&#x6E90;&#x7801;&#x53EF;&#x77E5; <code>ListView</code> &#x7684;&#x7F13;&#x5B58;&#x903B;&#x8F91;&#x662F;&#x5728;&#x5176;&#x7236;&#x7C7B; <code>AbsListView</code> &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x7C7B; <code>RecycleBin</code>&#x5B9E;&#x73B0;&#x7684;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * The RecycleBin facilitates reuse of views across layouts. The RecycleBin has two levels of</span></span><br><span class="line"><span class="hljs-comment"> * storage: ActiveViews and ScrapViews. ActiveViews are those views which were onscreen at the</span></span><br><span class="line"><span class="hljs-comment"> * start of a layout. By construction, they are displaying current information. At the end of</span></span><br><span class="line"><span class="hljs-comment"> * layout, all views in ActiveViews are demoted to ScrapViews. ScrapViews are old views that</span></span><br><span class="line"><span class="hljs-comment"> * could potentially be used by the adapter to avoid allocating views unnecessarily.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> android.widget.AbsListView#setRecyclerListener(android.widget.AbsListView.RecyclerListener)</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> android.widget.AbsListView.RecyclerListener</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RecycleBin</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">private</span> RecyclerListener mRecyclerListener;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The position of the first view stored in mActiveViews.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mFirstActivePosition;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Views that were on screen at the start of layout. This array is populated at the start of</span></span><br><span class="line"><span class="hljs-comment">     * layout, and at the end of layout all view in mActiveViews are moved to mScrapViews.</span></span><br><span class="line"><span class="hljs-comment">     * Views in mActiveViews represent a contiguous range of Views, with position of the first</span></span><br><span class="line"><span class="hljs-comment">     * view store in mFirstActivePosition.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> View[] mActiveViews = <span class="hljs-keyword">new</span> View[<span class="hljs-number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Unsorted views that can be used by the adapter as a convert view.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> ArrayList&lt;View&gt;[] mScrapViews;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x8FD9;&#x4E2A;&#x7C7B;&#x6709;&#x4E24;&#x4E2A;&#x7F13;&#x5B58;&#x7EA7;&#x522B;&#xFF1A;<p></p>
<ul>
<li>ActiveViews - &#x4E00;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x5E03;&#x5C40;&#x5F00;&#x59CB; layout &#x65F6;&#x663E;&#x793A;&#x7684; View</li>
<li>ScrapViews - &#x4E8C;&#x7EA7;&#x7F13;&#x5B58;&#xFF0C;&#x5F53; layout &#x7ED3;&#x675F;&#x540E; ActiveView &#x964D;&#x7EA7;&#x4E3A; ScrapView</li>
</ul>
<h4 id="&#x9996;&#x6B21;-onLayout"><a href="#&#x9996;&#x6B21;-onLayout" class="headerlink" title="&#x9996;&#x6B21; onLayout"></a>&#x9996;&#x6B21; onLayout</h4><p>&#x9996;&#x5148;&#x5206;&#x6790; <code>ListView</code> &#x7684;&#x9996;&#x6B21; <code>onLayout</code>&#xFF0C;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x53D1;&#x73B0;  <code>ListView</code> &#x4E2D;&#x6CA1;&#x6709; <code>onLayout</code>&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x7236;&#x7C7B; <code>AbsListView</code> &#x4E2D;&#x5B58;&#x5728;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Subclasses should NOT override this method but</span></span><br><span class="line"><span class="hljs-comment"> *  {<span class="hljs-doctag">@link</span> #layoutChildren()} instead.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLayout</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> changed, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> b)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">super</span>.onLayout(changed, l, t, r, b);</span><br><span class="line"></span><br><span class="line">    mInLayout = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> childCount = getChildCount();</span><br><span class="line">    <span class="hljs-keyword">if</span> (changed) {</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            getChildAt(i).forceLayout();</span><br><span class="line">        }</span><br><span class="line">        mRecycler.markChildrenDirty();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    layoutChildren();</span><br><span class="line"></span><br><span class="line">    mOverscrollMax = (b - t) / OVERSCROLL_LIMIT_DIVISOR;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Move somewhere sane. This doesn&apos;t belong in onLayout().</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (mFastScroll != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        mFastScroll.onItemCountChanged(getChildCount(), mItemCount);</span><br><span class="line">    }</span><br><span class="line">    mInLayout = <span class="hljs-keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6267;&#x884C;&#x4E86; <code>layoutChildren</code> &#x51FD;&#x6570;&#xFF0C;<code>layoutChildren</code> &#x51FD;&#x6570;&#x7531;&#x5B50;&#x7C7B;&#x5B9E;&#x73B0;&#xFF0C;&#x9996;&#x5148;&#x770B;&#x9996;&#x6B21; <code>onLayout</code> &#x65F6;&#x7684;&#x5173;&#x952E;&#x6B65;&#x9AA4;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">layoutChildren</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-comment">// &#x7531;&#x4E8E;&#x6570;&#x636E;&#x90FD;&#x5728; adapter &#x4E2D;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x9996;&#x6B21; layout &#x7684;&#x65F6;&#x5019;&#x8FD8;&#x6CA1;&#x6709;&#x6570;&#x636E;&#xFF0C;dataChanged &#x80AF;&#x5B9A;&#x662F; false&#xFF0C;&#x800C;&#x4E14;&#x6B64;&#x65F6; childCount &#x80AF;&#x5B9A;&#x662F; 0&#xFF0C;&#x6B64;&#x65F6;&#x6267;&#x884C; recycleBin#fillActiveViews &#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x610F;&#x4E49;</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (dataChanged) {</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            recycleBin.addScrapView(getChildAt(i), firstPosition+i);</span><br><span class="line">        }</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        recycleBin.fillActiveViews(childCount, firstPosition);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">// Clear out old views</span></span><br><span class="line">    detachAllViewsFromParent();</span><br><span class="line">    recycleBin.removeSkippedScrap();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// mLayoutMode &#x9ED8;&#x8BA4;&#x503C;&#x4E3A; LAYOUT_NORMAL&#xFF0C;&#x6240;&#x4EE5;&#x4EE3;&#x7801;&#x4F1A;&#x6267;&#x884C;&#x5230; default &#x4E2D;</span></span><br><span class="line">    <span class="hljs-keyword">switch</span> (mLayoutMode) {</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_SET_SELECTION:</span><br><span class="line">        <span class="hljs-keyword">if</span> (newSel != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            sel = fillFromSelection(newSel.getTop(), childrenTop, childrenBottom);</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            sel = fillFromMiddle(childrenTop, childrenBottom);</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_SYNC:</span><br><span class="line">        sel = fillSpecific(mSyncPosition, mSpecificTop);</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_FORCE_BOTTOM:</span><br><span class="line">        sel = fillUp(mItemCount - <span class="hljs-number">1</span>, childrenBottom);</span><br><span class="line">        adjustViewsUpOrDown();</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_FORCE_TOP:</span><br><span class="line">        mFirstPosition = <span class="hljs-number">0</span>;</span><br><span class="line">        sel = fillFromTop(childrenTop);</span><br><span class="line">        adjustViewsUpOrDown();</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_SPECIFIC:</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> selectedPosition = reconcileSelectedPosition();</span><br><span class="line">        sel = fillSpecific(selectedPosition, mSpecificTop);</span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * When ListView is resized, FocusSelector requests an async selection for the</span></span><br><span class="line"><span class="hljs-comment">         * previously focused item to make sure it is still visible. If the item is not</span></span><br><span class="line"><span class="hljs-comment">         * selectable, it won&apos;t regain focus so instead we call FocusSelector</span></span><br><span class="line"><span class="hljs-comment">         * to directly request focus on the view after it is visible.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (sel == <span class="hljs-keyword">null</span> &amp;&amp; mFocusSelector != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            <span class="hljs-keyword">final</span> Runnable focusRunnable = mFocusSelector</span><br><span class="line">                    .setupFocusIfValid(selectedPosition);</span><br><span class="line">            <span class="hljs-keyword">if</span> (focusRunnable != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                post(focusRunnable);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_MOVE_SELECTION:</span><br><span class="line">        sel = moveSelection(oldSel, newSel, delta, childrenTop, childrenBottom);</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">default</span>:</span><br><span class="line">        <span class="hljs-comment">// &#x7531;&#x4E8E;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x6240;&#x4EE5; childCount &#x4E5F;&#x662F; 0</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (childCount == <span class="hljs-number">0</span>) {</span><br><span class="line">            <span class="hljs-comment">// &#x7531;&#x4E8E;&#x5E03;&#x5C40;&#x9ED8;&#x8BA4;&#x7684;&#x6392;&#x5217;&#x987A;&#x5E8F;&#x662F;&#x81EA;&#x4E0A;&#x800C;&#x4E0B;&#x7684;&#xFF0C;&#x4F1A;&#x5F80;&#x4E0B;&#x6267;&#x884C; fillFromTop</span></span><br><span class="line">            <span class="hljs-comment">// &#x6CE8;&#x610F;&#x4F20;&#x5165; fillFromTop &#x7684;&#x53C2;&#x6570; childrenTop &#x5B9E;&#x9645;&#x4E3A;&#x7B2C;&#x4E00;&#x4E2A;&#x5B50;&#x5143;&#x7D20;&#x8DDD;&#x79BB; ListView &#x7684;&#x50CF;&#x7D20;&#x503C;&#xFF0C;&#x5982;&#x679C; ListView &#x6CA1;&#x6709;&#x8BBE;&#x7F6E; Padding&#xFF0C;&#x8BE5;&#x503C;&#x4E3A; 0</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (!mStackFromBottom) {</span><br><span class="line">                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> position = lookForSelectablePosition(<span class="hljs-number">0</span>, <span class="hljs-keyword">true</span>);</span><br><span class="line">                setSelectedPositionInt(position);</span><br><span class="line">                sel = fillFromTop(childrenTop);</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> position = lookForSelectablePosition(mItemCount - <span class="hljs-number">1</span>, <span class="hljs-keyword">false</span>);</span><br><span class="line">                setSelectedPositionInt(position);</span><br><span class="line">                sel = fillUp(mItemCount - <span class="hljs-number">1</span>, childrenBottom);</span><br><span class="line">            }</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            <span class="hljs-keyword">if</span> (mSelectedPosition &gt;= <span class="hljs-number">0</span> &amp;&amp; mSelectedPosition &lt; mItemCount) {</span><br><span class="line">                sel = fillSpecific(mSelectedPosition,</span><br><span class="line">                        oldSel == <span class="hljs-keyword">null</span> ? childrenTop : oldSel.getTop());</span><br><span class="line">            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mFirstPosition &lt; mItemCount) {</span><br><span class="line">                sel = fillSpecific(mFirstPosition,</span><br><span class="line">                        oldFirst == <span class="hljs-keyword">null</span> ? childrenTop : oldFirst.getTop());</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                sel = fillSpecific(<span class="hljs-number">0</span>, childrenTop);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x63A5;&#x7740;&#x5206;&#x6790; <code>fillFromTop</code> &#x51FD;&#x6570;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> View <span class="hljs-title">fillFromTop</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nextTop)</span> </span>{</span><br><span class="line">    mFirstPosition = Math.min(mFirstPosition, mSelectedPosition);</span><br><span class="line">    mFirstPosition = Math.min(mFirstPosition, mItemCount - <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (mFirstPosition &lt; <span class="hljs-number">0</span>) {</span><br><span class="line">        mFirstPosition = <span class="hljs-number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> fillDown(mFirstPosition, nextTop);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5BF9; <code>mFirstPosition</code> &#x8FDB;&#x884C;&#x4E00;&#x756A;&#x6821;&#x9A8C;&#x540E;&#xFF0C;&#x6700;&#x7EC8;&#x6267;&#x884C;&#x4E86; <code>fillDown</code> &#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> View <span class="hljs-title">fillDown</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> nextTop)</span> </span>{</span><br><span class="line">    View selectedView = <span class="hljs-keyword">null</span>;</span><br><span class="line">    <span class="hljs-comment">// end &#x4E3A; ListView &#x7684;&#x603B;&#x9AD8;&#x5EA6;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> end = (mBottom - mTop);</span><br><span class="line">    <span class="hljs-keyword">if</span> ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) {</span><br><span class="line">        end -= mListPadding.bottom;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">while</span> (nextTop &lt; end &amp;&amp; pos &lt; mItemCount) {</span><br><span class="line">        <span class="hljs-comment">// is this the selected item?</span></span><br><span class="line">        <span class="hljs-keyword">boolean</span> selected = pos == mSelectedPosition;</span><br><span class="line">        View child = makeAndAddView(pos, nextTop, <span class="hljs-keyword">true</span>, mListPadding.left, selected);</span><br><span class="line"></span><br><span class="line">        nextTop = child.getBottom() + mDividerHeight;</span><br><span class="line">        <span class="hljs-keyword">if</span> (selected) {</span><br><span class="line">            selectedView = child;</span><br><span class="line">        }</span><br><span class="line">        pos++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    setVisibleRangeHint(mFirstPosition, mFirstPosition + getChildCount() - <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> selectedView;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5728; <code>fillDown</code> &#x4E2D;&#x4F1A;&#x6709;&#x4E00;&#x4E2A; while &#x5FAA;&#x73AF;&#xFF0C;<code>end</code> &#x4E3A; ListView &#x7684;&#x603B;&#x9AD8;&#x5EA6;&#xFF0C;&#x5728;&#x5FAA;&#x73AF;&#x5F00;&#x59CB;&#x65F6; <code>nextTop</code> &#x5FC5;&#x5B9A;&#x5C0F;&#x4E8E; <code>end</code>&#xFF0C;<code>mItemCount</code> &#x662F;&#x901A;&#x8FC7; <code>BaseAdapter#getCount</code>&#xFF0C;&#x6240;&#x4EE5; <code>pos</code> &#x4E5F;&#x662F;&#x5C0F;&#x4E8E; <code>mItemCount</code>&#xFF0C;&#x901A;&#x8FC7;&#x6267;&#x884C; <code>makeAndAddView</code> &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x7684; <code>View</code>&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8BE5; <code>View</code> &#x8DDD;&#x79BB; <code>ListView</code> &#x9876;&#x90E8;&#x9AD8;&#x5EA6;&#x4E0E;&#x5206;&#x5272;&#x7EBF;&#x9AD8;&#x5EA6;&#x548C;&#x91CD;&#x65B0;&#x8D4B;&#x503C;&#x7ED9; <code>nextTop</code>&#xFF0C;&#x540C;&#x65F6;&#x5C06; <code>pos</code> &#x52A0;&#x4E0A; 1 &#x7EE7;&#x7EED;&#x4E0B;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x67E5;&#x770B;&#x4E00;&#x4E0B; <code>makeAndAddView</code> &#x51FD;&#x6570;&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> View <span class="hljs-title">makeAndAddView</span><span class="hljs-params">(<span class="hljs-keyword">int</span> position, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">boolean</span> flow, <span class="hljs-keyword">int</span> childrenLeft,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> selected)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (!mDataChanged) {</span><br><span class="line">        <span class="hljs-comment">// Try to use an existing view for this position.</span></span><br><span class="line">        <span class="hljs-keyword">final</span> View activeView = mRecycler.getActiveView(position);</span><br><span class="line">        <span class="hljs-keyword">if</span> (activeView != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            <span class="hljs-comment">// Found it. We&apos;re reusing an existing child, so it just needs</span></span><br><span class="line">            <span class="hljs-comment">// to be positioned like a scrap view.</span></span><br><span class="line">            setupChild(activeView, position, y, flow, childrenLeft, selected, <span class="hljs-keyword">true</span>);</span><br><span class="line">            <span class="hljs-keyword">return</span> activeView;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Make a new view for this position, or convert an unused view if</span></span><br><span class="line">    <span class="hljs-comment">// possible.</span></span><br><span class="line">    <span class="hljs-keyword">final</span> View child = obtainView(position, mIsScrap);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// This needs to be positioned and measured.</span></span><br><span class="line">    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[<span class="hljs-number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> child;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x7531;&#x4E8E;&#x6267;&#x884C;&#x5230;&#x8BE5;&#x51FD;&#x6570;&#x65F6;&#xFF0C;<code>mDataChanged</code> &#x7684;&#x503C;&#x4E00;&#x76F4;&#x4E3A; false&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6267;&#x884C; <code>mRecycler.getActiveView</code> &#x6765;&#x83B7;&#x53D6; View &#x5BF9;&#x8C61;&#xFF0C;&#x6B64;&#x65F6;&#x83B7;&#x53D6;&#x5230;&#x7684; View &#x5BF9;&#x8C61;&#x80AF;&#x5B9A;&#x662F; <code>null</code>&#xFF1B;&#x6240;&#x4EE5;&#x8FD8;&#x4F1A;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#xFF0C;&#x901A;&#x8FC7; <code>obtainView</code> &#x83B7;&#x53D6; View &#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x5728; <code>AbsListView</code> &#x7C7B;&#x4E2D;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">View <span class="hljs-title">obtainView</span><span class="hljs-params">(<span class="hljs-keyword">int</span> position, <span class="hljs-keyword">boolean</span>[] outMetadata)</span> </span>{</span><br><span class="line">    Trace.traceBegin(Trace.TRACE_TAG_VIEW, <span class="hljs-string">&quot;obtainView&quot;</span>);</span><br><span class="line"></span><br><span class="line">    outMetadata[<span class="hljs-number">0</span>] = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Check whether we have a transient state view. Attempt to re-bind the</span></span><br><span class="line">    <span class="hljs-comment">// data and discard the view if we fail.</span></span><br><span class="line">    <span class="hljs-keyword">final</span> View transientView = mRecycler.getTransientStateView(position);</span><br><span class="line">    <span class="hljs-keyword">if</span> (transientView != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        <span class="hljs-keyword">final</span> LayoutParams params = (LayoutParams) transientView.getLayoutParams();</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// If the view type hasn&apos;t changed, attempt to re-bind the data.</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (params.viewType == mAdapter.getItemViewType(position)) {</span><br><span class="line">            <span class="hljs-keyword">final</span> View updatedView = mAdapter.getView(position, transientView, <span class="hljs-keyword">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// If we failed to re-bind the data, scrap the obtained view.</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (updatedView != transientView) {</span><br><span class="line">                setItemViewLayoutParams(updatedView, position);</span><br><span class="line">                mRecycler.addScrapView(updatedView, position);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        outMetadata[<span class="hljs-number">0</span>] = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// Finish the temporary detach started in addScrapView().</span></span><br><span class="line">        transientView.dispatchFinishTemporaryDetach();</span><br><span class="line">        <span class="hljs-keyword">return</span> transientView;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// &#x7279;&#x522B;&#x6CE8;&#x610F;&#x8FD9;&#x4E24;&#x884C;&#x4EE3;&#x7801;</span></span><br><span class="line">    <span class="hljs-keyword">final</span> View scrapView = mRecycler.getScrapView(position);</span><br><span class="line">    <span class="hljs-keyword">final</span> View child = mAdapter.getView(position, scrapView, <span class="hljs-keyword">this</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (scrapView != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (child != scrapView) {</span><br><span class="line">            <span class="hljs-comment">// Failed to re-bind the data, return scrap to the heap.</span></span><br><span class="line">            mRecycler.addScrapView(scrapView, position);</span><br><span class="line">        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (child.isTemporarilyDetached()) {</span><br><span class="line">            outMetadata[<span class="hljs-number">0</span>] = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// Finish the temporary detach started in addScrapView().</span></span><br><span class="line">            child.dispatchFinishTemporaryDetach();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (mCacheColorHint != <span class="hljs-number">0</span>) {</span><br><span class="line">        child.setDrawingCacheBackgroundColor(mCacheColorHint);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (child.getImportantForAccessibility() == IMPORTANT_FOR_ACCESSIBILITY_AUTO) {</span><br><span class="line">        child.setImportantForAccessibility(IMPORTANT_FOR_ACCESSIBILITY_YES);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    setItemViewLayoutParams(child, position);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (AccessibilityManager.getInstance(mContext).isEnabled()) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (mAccessibilityDelegate == <span class="hljs-keyword">null</span>) {</span><br><span class="line">            mAccessibilityDelegate = <span class="hljs-keyword">new</span> ListItemAccessibilityDelegate();</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (child.getAccessibilityDelegate() == <span class="hljs-keyword">null</span>) {</span><br><span class="line">            child.setAccessibilityDelegate(mAccessibilityDelegate);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> child;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x9996;&#x5148;&#x4F1A;&#x6267;&#x884C; <code>mRecycler.getScrapView()</code> &#x4ECE;&#x5E9F;&#x5F03;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x83B7;&#x53D6; View &#x5BF9;&#x8C61;&#xFF0C;&#x6B64;&#x65F6;&#x8BE5; View &#x5BF9;&#x8C61;&#x5FC5;&#x7136;&#x662F; <code>null</code>&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8BE5;&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x7ED9; <code>mAdapter.getView()</code>&#xFF1B;&#x81F3;&#x6B64;&#x5C31;&#x5230;&#x4E86;&#x975E;&#x5E38;&#x719F;&#x6089;&#x7684; <code>Adapter</code> &#x4E86;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x79CD;&#x5E38;&#x89C1;&#x7684; <code>ListView</code> &#x4F18;&#x5316;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x901A;&#x8FC7; <code>ViewHolder</code> &#x51CF;&#x5C11;&#x521B;&#x5EFA; View &#x5BF9;&#x8C61;&#x7684;&#x6B21;&#x6570;&#xFF1A;<p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">override fun <span class="hljs-title">getView</span><span class="hljs-params">(position: Int, convertView: View?, parent: ViewGroup?)</span>: View? </span>{</span><br><span class="line">    val holder: TestViewHolder</span><br><span class="line">    val v: View</span><br><span class="line">    <span class="hljs-comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x4ECE;&#x5E9F;&#x5F03;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x5230; View &#x5BF9;&#x8C61;&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#xFF0C;&#x628A; ViewHolder &#x5BF9;&#x8C61;&#x7ED1;&#x5B9A;&#x5230;&#x8BE5; View &#x7684; tag &#x5C5E;&#x6027;&#x4E0A;&#xFF0C;&#x540C;&#x65F6; ViewHolder &#x6301;&#x6709;&#x8BE5; View &#x7684;&#x5F15;&#x7528;</span></span><br><span class="line">    <span class="hljs-comment">// &#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x4ECE;&#x8BE5; View &#x4E2D;&#x83B7;&#x53D6; ViewHolder&#xFF0C;&#x4E0D;&#x5FC5;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x65B0;&#x7684; View &#x5BF9;&#x8C61;</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (convertView == <span class="hljs-keyword">null</span>) {</span><br><span class="line">        v = View.inflate(context, R.layout.my_text_view, <span class="hljs-keyword">null</span>)</span><br><span class="line">        holder = TestViewHolder(v)</span><br><span class="line">        v.tag = holder</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        v = convertView</span><br><span class="line">        holder = v.tag as TestViewHolder</span><br><span class="line">    }</span><br><span class="line">    holder.str.text = data[position]</span><br><span class="line">    <span class="hljs-keyword">return</span> v</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class TestViewHolder(viewItem: View) {</span><br><span class="line">    <span class="hljs-keyword">var</span> str: TextView = viewItem.findViewById(R.id.tv) as TextView</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="&#x7B2C;&#x4E8C;&#x6B21;-onLayout"><a href="#&#x7B2C;&#x4E8C;&#x6B21;-onLayout" class="headerlink" title="&#x7B2C;&#x4E8C;&#x6B21; onLayout"></a>&#x7B2C;&#x4E8C;&#x6B21; onLayout</h4><p>&#x81F3;&#x6B64;&#x5C31;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x9700;&#x8981;&#x663E;&#x793A;&#x7684; View &#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x901A;&#x8FC7; <code>setupChild</code> &#x586B;&#x5145;&#x5230; <code>ListView</code> &#x4E2D;&#xFF0C;&#x4E0D;&#x8981;&#x5FD8;&#x8BB0;&#x6B64;&#x65F6;&#x8FD8;&#x5728; <code>fillDown</code> &#x51FD;&#x6570;&#x4E2D;&#x7684; while &#x5FAA;&#x73AF;&#x5F53;&#x4E2D;&#xFF0C;&#x5F53; <code>ListView</code> &#x52A0;&#x8F7D;&#x5B8C;&#x9996;&#x5C4F;&#x6570;&#x636E;&#x540E;&#x5C31;&#x4F1A;&#x8DF3;&#x51FA;&#x8BE5;&#x5FAA;&#x73AF;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x8FC7;&#x591A;&#x5BFC;&#x81F4; <code>OOM</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x4EC5;&#x4EC5;&#x662F;&#x9996;&#x6B21; <code>onLayout</code> &#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8FD8;&#x6709;&#x7B2C;&#x4E8C;&#x6B21; <code>onLayout</code>&#xFF0C;&#x8FC7;&#x7A0B;&#x548C;&#x9996;&#x6B21;&#x8FD8;&#x662F;&#x6709;&#x4E9B;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x9996;&#x5148;&#x8FD8;&#x662F;&#x5148;&#x4ECE; <code>layoutChild</code> &#x6765;&#x770B;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">layoutChildren</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-comment">// &#x7531;&#x4E8E;&#x6B64;&#x524D;&#x5DF2;&#x7ECF;&#x586B;&#x5145;&#x4E86; ListView&#xFF0C;&#x6B64;&#x65F6; childCount &#x4E0D;&#x4E3A; 0&#xFF0C;&#x628A;&#x5F53;&#x524D;&#x6240;&#x6709;&#x5B50; View &#x90FD;&#x7F13;&#x5B58;&#x5230;&#x4E86;&#x6D3B;&#x8DC3;&#x7F13;&#x5B58;&#x533A;&#x4E2D;</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (dataChanged) {</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; childCount; i++) {</span><br><span class="line">            recycleBin.addScrapView(getChildAt(i), firstPosition+i);</span><br><span class="line">        }</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        recycleBin.fillActiveViews(childCount, firstPosition);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">// Clear out old views</span></span><br><span class="line">    <span class="hljs-comment">// &#x8BE5;&#x51FD;&#x6570;&#x4F1A;&#x6E05;&#x7A7A; ListView &#x4E2D;&#x6240;&#x6709;&#x7684; View &#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#xFF0C;&#x8FD9;&#x4E9B; View &#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x88AB;&#x7F13;&#x5B58;&#x4E86;</span></span><br><span class="line">    detachAllViewsFromParent();</span><br><span class="line">    recycleBin.removeSkippedScrap();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// mLayoutMode &#x9ED8;&#x8BA4;&#x503C;&#x4E3A; LAYOUT_NORMAL&#xFF0C;&#x6240;&#x4EE5;&#x4EE3;&#x7801;&#x4F1A;&#x6267;&#x884C;&#x5230; default &#x4E2D;</span></span><br><span class="line">    <span class="hljs-keyword">switch</span> (mLayoutMode) {</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_SET_SELECTION:</span><br><span class="line">        <span class="hljs-keyword">if</span> (newSel != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            sel = fillFromSelection(newSel.getTop(), childrenTop, childrenBottom);</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            sel = fillFromMiddle(childrenTop, childrenBottom);</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_SYNC:</span><br><span class="line">        sel = fillSpecific(mSyncPosition, mSpecificTop);</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_FORCE_BOTTOM:</span><br><span class="line">        sel = fillUp(mItemCount - <span class="hljs-number">1</span>, childrenBottom);</span><br><span class="line">        adjustViewsUpOrDown();</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_FORCE_TOP:</span><br><span class="line">        mFirstPosition = <span class="hljs-number">0</span>;</span><br><span class="line">        sel = fillFromTop(childrenTop);</span><br><span class="line">        adjustViewsUpOrDown();</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_SPECIFIC:</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> selectedPosition = reconcileSelectedPosition();</span><br><span class="line">        sel = fillSpecific(selectedPosition, mSpecificTop);</span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * When ListView is resized, FocusSelector requests an async selection for the</span></span><br><span class="line"><span class="hljs-comment">         * previously focused item to make sure it is still visible. If the item is not</span></span><br><span class="line"><span class="hljs-comment">         * selectable, it won&apos;t regain focus so instead we call FocusSelector</span></span><br><span class="line"><span class="hljs-comment">         * to directly request focus on the view after it is visible.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (sel == <span class="hljs-keyword">null</span> &amp;&amp; mFocusSelector != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            <span class="hljs-keyword">final</span> Runnable focusRunnable = mFocusSelector</span><br><span class="line">                    .setupFocusIfValid(selectedPosition);</span><br><span class="line">            <span class="hljs-keyword">if</span> (focusRunnable != <span class="hljs-keyword">null</span>) {</span><br><span class="line">                post(focusRunnable);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">case</span> LAYOUT_MOVE_SELECTION:</span><br><span class="line">        sel = moveSelection(oldSel, newSel, delta, childrenTop, childrenBottom);</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    <span class="hljs-keyword">default</span>:</span><br><span class="line">        <span class="hljs-comment">// &#x6B64;&#x65F6; childCount &#x975E; 0&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6B21;&#x4F1A;&#x6267;&#x884C; fillSpecific</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (childCount == <span class="hljs-number">0</span>) {</span><br><span class="line">            <span class="hljs-keyword">if</span> (!mStackFromBottom) {</span><br><span class="line">                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> position = lookForSelectablePosition(<span class="hljs-number">0</span>, <span class="hljs-keyword">true</span>);</span><br><span class="line">                setSelectedPositionInt(position);</span><br><span class="line">                sel = fillFromTop(childrenTop);</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> position = lookForSelectablePosition(mItemCount - <span class="hljs-number">1</span>, <span class="hljs-keyword">false</span>);</span><br><span class="line">                setSelectedPositionInt(position);</span><br><span class="line">                sel = fillUp(mItemCount - <span class="hljs-number">1</span>, childrenBottom);</span><br><span class="line">            }</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            <span class="hljs-keyword">if</span> (mSelectedPosition &gt;= <span class="hljs-number">0</span> &amp;&amp; mSelectedPosition &lt; mItemCount) {</span><br><span class="line">                sel = fillSpecific(mSelectedPosition,</span><br><span class="line">                        oldSel == <span class="hljs-keyword">null</span> ? childrenTop : oldSel.getTop());</span><br><span class="line">            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mFirstPosition &lt; mItemCount) {</span><br><span class="line">                sel = fillSpecific(mFirstPosition,</span><br><span class="line">                        oldFirst == <span class="hljs-keyword">null</span> ? childrenTop : oldFirst.getTop());</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                sel = fillSpecific(<span class="hljs-number">0</span>, childrenTop);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line">``` </span><br><span class="line">`fillSpecific` &#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x548C; `fillDown` &#x5927;&#x76F8;&#x5F84;&#x5EAD;&#xFF0C;&#x6682;&#x65F6;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5B83;&#x7684;&#x5185;&#x90E8;&#x7EC6;&#x8282;&#xFF0C;`fillSpecific` &#x5185;&#x90E8;&#x6700;&#x7EC8;&#x4E5F;&#x4F1A;&#x6267;&#x884C; `makeAndAddView`&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x518D;&#x6B21;&#x6267;&#x884C; `mRecycler.getActiveView` &#x5C31;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x7F13;&#x5B58;&#x8FC7;&#x7684; View &#x5BF9;&#x8C61;&#x4E86;&#xFF0C;&#x63A5;&#x7740;&#x6267;&#x884C; `setupChild`&#xFF0C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x8868;&#x793A;&#x5F53;&#x524D;&#x7684; View &#x5BF9;&#x8C61;&#x662F;&#x5426;&#x88AB;&#x6DFB;&#x52A0;&#x5230; Window &#x8FC7;&#xFF0C;&#x770B;&#x6E90;&#x7801;&#x83B7;&#x53D6;&#x8BE5;&#x53C2;&#x6570;&#x7684;&#x4E3B;&#x8981;&#x7528;&#x9014;&#xFF1A;</span><br><span class="line"></span><br><span class="line">```Java</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setupChild</span><span class="hljs-params">(View child, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">boolean</span> flowDown, <span class="hljs-keyword">int</span> childrenLeft, <span class="hljs-keyword">boolean</span> selected, <span class="hljs-keyword">boolean</span> isAttachedToWindow)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-keyword">if</span> ((isAttachedToWindow &amp;&amp; !p.forceAdd) || (p.recycledHeaderFooter</span><br><span class="line">            &amp;&amp; p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER)) {</span><br><span class="line">        attachViewToParent(child, flowDown ? -<span class="hljs-number">1</span> : <span class="hljs-number">0</span>, p);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// If the view was previously attached for a different position,</span></span><br><span class="line">        <span class="hljs-comment">// then manually jump the drawables.</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (isAttachedToWindow</span><br><span class="line">                &amp;&amp; (((AbsListView.LayoutParams) child.getLayoutParams()).scrappedFromPosition)</span><br><span class="line">                        != position) {</span><br><span class="line">            child.jumpDrawablesToCurrentState();</span><br><span class="line">        }</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        p.forceAdd = <span class="hljs-keyword">false</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER) {</span><br><span class="line">            p.recycledHeaderFooter = <span class="hljs-keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        addViewInLayout(child, flowDown ? -<span class="hljs-number">1</span> : <span class="hljs-number">0</span>, p, <span class="hljs-keyword">true</span>);</span><br><span class="line">        <span class="hljs-comment">// add view in layout will reset the RTL properties. We have to re-resolve them</span></span><br><span class="line">        child.resolveRtlPropertiesIfNeeded();</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5982;&#x679C;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;&#x8FC7;&#x6267;&#x884C; <code>addViewInLayout</code>&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x6267;&#x884C; <code>attachViewToParent</code>&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x5173;&#x952E;&#x533A;&#x522B;&#x5728;&#x4E8E; <code>addViewInLayout</code> &#x662F;&#x5F80; <code>ViewGroup</code> &#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5B50; View&#xFF0C;&#x4F1A;&#x91CD;&#x65B0;&#x6E32;&#x67D3;&#x3002;&#x800C; <code>attachViewToParent</code> &#x5219;&#x662F;&#x5C06;&#x4E4B;&#x524D;&#x901A;&#x8FC7; <code>detachViewFromParent</code> &#x79FB;&#x51FA; <code>ViewGroup</code> &#x7684;&#x5B50; View &#x91CD;&#x65B0;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x4E0D;&#x4F1A;&#x91CD;&#x65B0;&#x6E32;&#x67D3;&#xFF0C;&#x81F3;&#x6B64;&#x4E24;&#x6B21; <code>onLayout</code> &#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x7ED3;&#x675F;<p></p>
<p><img src="https://image.kangxiaoguang.com/1528456818.png" alt></p>
<h4 id="&#x6ED1;&#x52A8;-1"><a href="#&#x6ED1;&#x52A8;-1" class="headerlink" title="&#x6ED1;&#x52A8;"></a>&#x6ED1;&#x52A8;</h4><p>&#x5728; ListView &#x6ED1;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#xFF1A;</p>
<p><img src="https://image.kangxiaoguang.com/1528700789.png" alt></p>
<p>&#x6700;&#x7EC8;&#x8FD8;&#x662F;&#x4F1A;&#x6267;&#x884C; <code>makeAndAddView()</code> &#x51FD;&#x6570;&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> View <span class="hljs-title">makeAndAddView</span><span class="hljs-params">(<span class="hljs-keyword">int</span> position, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">boolean</span> flow, <span class="hljs-keyword">int</span> childrenLeft,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> selected)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (!mDataChanged) {</span><br><span class="line">        <span class="hljs-keyword">final</span> View activeView = mRecycler.getActiveView(position);</span><br><span class="line">        <span class="hljs-keyword">if</span> (activeView != <span class="hljs-keyword">null</span>) {</span><br><span class="line">            <span class="hljs-comment">// Found it. We&apos;re reusing an existing child, so it just needs</span></span><br><span class="line">            <span class="hljs-comment">// to be positioned like a scrap view.</span></span><br><span class="line">            setupChild(activeView, position, y, flow, childrenLeft, selected, <span class="hljs-keyword">true</span>);</span><br><span class="line">            <span class="hljs-keyword">return</span> activeView;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Make a new view for this position, or convert an unused view if</span></span><br><span class="line">    <span class="hljs-comment">// possible.</span></span><br><span class="line">    <span class="hljs-keyword">final</span> View child = obtainView(position, mIsScrap);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// This needs to be positioned and measured.</span></span><br><span class="line">    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[<span class="hljs-number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> child;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x7531;&#x4E8E;&#x6B64;&#x65F6; <code>mRecycler.getActiveView</code> &#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x4E0D;&#x5230; activeView&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x4F1A;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#x5230; <code>obtainView()</code>&#xFF0C;&#x5728; <code>obtainView()</code> &#x4E2D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>mRecycler.getScrapView</code> &#x4ECE;&#x5E9F;&#x5F03;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x5230; View &#x8FDB;&#x884C;&#x590D;&#x7528;&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x6D41;&#x7A0B;&#x548C; <code>onLayout</code> &#x65F6;&#x76F8;&#x540C;&#xFF0C;&#x5230;&#x6B64; ListView &#x7684;&#x7F13;&#x5B58;&#x5206;&#x6790;&#x5DF2;&#x7ECF;&#x7ED3;&#x675F;<p></p>
<h3 id="RecyclerView-&#x5206;&#x6790;"><a href="#RecyclerView-&#x5206;&#x6790;" class="headerlink" title="RecyclerView &#x5206;&#x6790;"></a>RecyclerView &#x5206;&#x6790;</h3><p>&#x5728;&#x521A;&#x5F00;&#x59CB;&#x4F7F;&#x7528; <code>RecyclerView</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x53D1;&#x751F;&#x7531;&#x4E8E;&#x5FD8;&#x8BB0;&#x8BBE;&#x7F6E; <code>LayoutManager</code> &#x5BFC;&#x81F4;&#x5E03;&#x5C40;&#x6E32;&#x67D3;&#x4E0D;&#x51FA;&#x6765;&#xFF0C;&#x6765;&#x770B;&#x4E00;&#x4E0B; <code>RecyclerView#LayoutManager</code> &#x7684;&#x90E8;&#x5206;&#x5B98;&#x65B9;&#x89E3;&#x91CA;&#xFF1A;</p>
<blockquote>
<p>A LayoutManager is responsible for measuring and positioning item views within a RecyclerView as well as determining the policy for when to recycle item views that are no longer visible to the user</p>
</blockquote>
<p>LayoutManager &#x8D1F;&#x8D23;&#x6D4B;&#x91CF;&#x548C;&#x5B9A;&#x4F4D; RecyclerView &#x4E2D;&#x7684; item&#xFF0C;&#x5E76;&#x4E14;&#x8D1F;&#x8D23;&#x786E;&#x5B9A;&#x4F55;&#x65F6;&#x56DE;&#x6536;&#x8FD9;&#x4E9B;&#x4E0D;&#x53EF;&#x89C1; item &#x7684;&#x7B56;&#x7565;&#xFF0C;&#x5728; <code>RecyclerView</code> &#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x51FD;&#x6570; <code>onLayoutChildren()</code>&#xFF1A;</p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLayoutChildren</span><span class="hljs-params">(Recycler recycler, State state)</span> </span>{</span><br><span class="line">    Log.e(TAG, <span class="hljs-string">&quot;You must override onLayoutChildren(Recycler recycler, State state) &quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5217;&#x51FA; adapter &#x4E2D;&#x6240;&#x6709;&#x7684; view&#xFF0C;&#x800C;&#x4E14;&#x6BCF;&#x4E2A;&#x4E0D;&#x540C;&#x7684; <code>LayoutManager</code> &#x90FD;&#x9700;&#x8981;&#x91CD;&#x5199;&#x8BE5;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x4ECE; <code>LinearLayoutManager#onLayoutChildren</code> &#x5F00;&#x59CB;&#x5206;&#x6790;&#xFF0C;&#x5728; <code>onLayoutChildren</code> &#x4E2D;&#x4E5F;&#x6709;&#x8C03;&#x7528;&#x4E86;&#x548C; <code>fillActiveViews()</code> &#x529F;&#x80FD;&#x76F8;&#x4F3C;&#x7684;&#x4E00;&#x4E2A;&#x51FD;&#x6570; <code>detachAndScrapAttachedViews()</code> &#x6765;&#x7F13;&#x5B58;&#x4E4B;&#x524D;&#x6240;&#x6709;&#x7684; View&#xFF0C;&#x63A5;&#x7740;&#x6267;&#x884C; <code>fill()</code> &#x5BF9; <code>RecyclerView</code> &#x8FDB;&#x884C;&#x586B;&#x5145;&#xFF1A;<p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fill</span><span class="hljs-params">(RecyclerView.Recycler recycler, LayoutState layoutState,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        RecyclerView.State state, <span class="hljs-keyword">boolean</span> stopOnFocusable)</span> </span>{</span><br><span class="line">    <span class="hljs-comment">// max offset we should set is mFastScroll + available</span></span><br><span class="line">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> start = layoutState.mAvailable;</span><br><span class="line">    <span class="hljs-keyword">if</span> (layoutState.mScrollingOffset != LayoutState.SCROLLING_OFFSET_NaN) {</span><br><span class="line">        <span class="hljs-comment">// TODO ugly bug fix. should not happen</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (layoutState.mAvailable &lt; <span class="hljs-number">0</span>) {</span><br><span class="line">            layoutState.mScrollingOffset += layoutState.mAvailable;</span><br><span class="line">        }</span><br><span class="line">        recycleByLayoutState(recycler, layoutState);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">int</span> remainingSpace = layoutState.mAvailable + layoutState.mExtra;</span><br><span class="line">    LayoutChunkResult layoutChunkResult = mLayoutChunkResult;</span><br><span class="line">    <span class="hljs-keyword">while</span> ((layoutState.mInfinite || remainingSpace &gt; <span class="hljs-number">0</span>) &amp;&amp; layoutState.hasMore(state)) {</span><br><span class="line">        layoutChunkResult.resetInternal();</span><br><span class="line">        <span class="hljs-keyword">if</span> (VERBOSE_TRACING) {</span><br><span class="line">            TraceCompat.beginSection(<span class="hljs-string">&quot;LLM LayoutChunk&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        layoutChunk(recycler, state, layoutState, layoutChunkResult);</span><br><span class="line">        <span class="hljs-keyword">if</span> (VERBOSE_TRACING) {</span><br><span class="line">            TraceCompat.endSection();</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (layoutChunkResult.mFinished) {</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        layoutState.mOffset += layoutChunkResult.mConsumed * layoutState.mLayoutDirection;</span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Consume the available space if:</span></span><br><span class="line"><span class="hljs-comment">         * * layoutChunk did not request to be ignored</span></span><br><span class="line"><span class="hljs-comment">         * * OR we are laying out scrap children</span></span><br><span class="line"><span class="hljs-comment">         * * OR we are not doing pre-layout</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (!layoutChunkResult.mIgnoreConsumed || mLayoutState.mScrapList != <span class="hljs-keyword">null</span></span><br><span class="line">                || !state.isPreLayout()) {</span><br><span class="line">            layoutState.mAvailable -= layoutChunkResult.mConsumed;</span><br><span class="line">            <span class="hljs-comment">// we keep a separate remaining space because mAvailable is important for recycling</span></span><br><span class="line">            remainingSpace -= layoutChunkResult.mConsumed;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (layoutState.mScrollingOffset != LayoutState.SCROLLING_OFFSET_NaN) {</span><br><span class="line">            layoutState.mScrollingOffset += layoutChunkResult.mConsumed;</span><br><span class="line">            <span class="hljs-keyword">if</span> (layoutState.mAvailable &lt; <span class="hljs-number">0</span>) {</span><br><span class="line">                layoutState.mScrollingOffset += layoutState.mAvailable;</span><br><span class="line">            }</span><br><span class="line">            recycleByLayoutState(recycler, layoutState);</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (stopOnFocusable &amp;&amp; layoutChunkResult.mFocusable) {</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span> (DEBUG) {</span><br><span class="line">        validateChildOrder();</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> start - layoutState.mAvailable;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x5728; <code>fill()</code> &#x4E2D;&#x4E0D;&#x505C;&#x5224;&#x65AD;&#x5269;&#x4F59;&#x7A7A;&#x95F4;&#x548C;&#x662F;&#x5426;&#x6709;&#x66F4;&#x591A;&#x7684; item&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C; <code>layoutChunk()</code> &#x586B;&#x5145;&#x5E03;&#x5C40;&#xFF0C;&#x5728; <code>layoutChunk()</code> &#x4E2D;&#x53C8;&#x6267;&#x884C;&#x4E86; <code>layoutState.next()</code> &#x83B7;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x663E;&#x793A;&#x7684; View&#xFF1A;<p></p>
<p></p><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-function">View <span class="hljs-title">next</span><span class="hljs-params">(RecyclerView.Recycler recycler)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (mScrapList != <span class="hljs-keyword">null</span>) {</span><br><span class="line">        <span class="hljs-keyword">return</span> nextViewFromScrapList();</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">final</span> View view = recycler.getViewForPosition(mCurrentPosition);</span><br><span class="line">    mCurrentPosition += mItemDirection;</span><br><span class="line">    <span class="hljs-keyword">return</span> view;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x6B64;&#x65F6;&#x5C31;&#x80FD;&#x770B;&#x5230; <code>RecyclerView</code> &#x56DE;&#x6536;&#x673A;&#x5236;&#x7684;&#x5173;&#x952E;&#x51FD;&#x6570; <code>getViewForPosition()</code>&#xFF0C;<code>Recycler</code> &#x662F; <code>RecyclerView</code> &#x5B9E;&#x73B0;&#x56DE;&#x6536;&#x673A;&#x5236;&#x7684;&#x5173;&#x952E;&#x7C7B;&#xFF0C;&#x548C; <code>ListView</code> &#x7F13;&#x5B58;&#x673A;&#x5236;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;<code>RecyclerView</code> &#x7F13;&#x5B58;&#x7684;&#x662F; <code>ViewHolder</code>&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;&#x56DB;&#x7EA7;&#x7F13;&#x5B58;&#xFF1A;<p></p>
<ul>
<li>mAttachedScrap - &#x7F13;&#x5B58;&#x5C4F;&#x5E55;&#x4E0A;&#x7684; <code>ViewHolder</code></li>
<li>mChangedScrap - &#x5DF2;&#x7ECF;&#x5206;&#x79BB;&#x7684; <code>ViewHolder</code></li>
<li>mCachedViews - &#x7F13;&#x5B58;&#x5C4F;&#x5E55;&#x5916;&#x7684; <code>ViewHolder</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;2&#x4E2A;&#xFF0C;<code>ListView</code> &#x5BF9;&#x4E8E;&#x5C4F;&#x5E55;&#x5916;&#x7684;&#x7F13;&#x5B58;&#x90FD;&#x4F1A;&#x8C03;&#x7528;<code>getView()</code></li>
<li>mRecyclerPool - &#x7528;&#x4E8E;&#x591A;&#x4E2A; <code>RecyclerView</code> &#x7684;&#x7F13;&#x5B58;&#x6C60;</li>
<li>mViewCacheExtension - &#x7528;&#x6237;&#x5B9A;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E0D;&#x5B9E;&#x73B0;</li>
</ul>
<p><code>getViewForPosition()</code> &#x6700;&#x7EC8;&#x4F1A;&#x6267;&#x884C; <code>tryGetViewHolderForPositionByDeadline()</code> &#x83B7;&#x53D6; <code>ViewHolder</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x56FE;&#xFF1A;</p>
<p><img src="https://image.kangxiaoguang.com/1528794924.png" alt></p>
<p><code>RecyclerView</code> &#x7684;&#x4F18;&#x52BF;&#x5728;&#x4E8E; <code>mCacheViews</code> &#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x5C4F;&#x5E55;&#x5916;&#x7684;&#x5217;&#x8868;&#x9879; ItemView &#x8FDB;&#x5165;&#x5C4F;&#x5E55;&#x5185;&#x65F6;&#x4E5F;&#x65E0;&#x987B; bindView &#x5FEB;&#x901F;&#x91CD;&#x7528;&#xFF1B;<code>mRecyclerPool</code> &#x53EF;&#x4EE5;&#x4F9B;&#x591A;&#x4E2A; <code>RecyclerView</code> &#x5171;&#x540C;&#x4F7F;&#x7528;</p>
</body></html>
    
    </div>
    

    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/object-Object/">#[object Object]</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">#读书笔记</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2018/05/28/Android/Groovy-%E5%85%A5%E9%97%A8/">Groovy 入门</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2018/01/26/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AAndroid-%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B-%E7%AC%AC%E4%BA%8C%E7%AB%A0%E5%86%85%E5%AE%B9%E6%80%BB%E7%BB%93/">《Android 开发艺术探索》- 第二章内容总结</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5e62ac01d0c39800126ea9e5&amp;product=inline-share-buttons&amp;cms=sop' async='async'></script>

</div>



<div class="comments">
    <h3 class="title is-4">评论</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2018/04/20/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AAndroid-%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B-%E7%AC%AC%E4%B8%89%E7%AB%A0%E5%86%85%E5%AE%B9%E6%80%BB%E7%BB%93/';
        this.page.identifier = '2018/04/20/读书笔记/《Android-开发艺术探索》-第三章内容总结/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'lovedev-org-1' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
</div>


    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 Kevin&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/KevinLoveGitHub" target="_blank" rel="noopener">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>